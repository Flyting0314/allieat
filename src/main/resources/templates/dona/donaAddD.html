<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<head>
<th:block th:replace="fragments/header :: header"></th:block>
    <style>
        /* ç¢ºä¿è¡¨æ ¼éŸ¿æ‡‰å¼ï¼Œæ‰‹æ©Ÿç‰ˆå¯ä»¥å·¦å³æ»‘å‹• */
        .table-responsive {
            overflow-x: auto;
        }

        /* æŸ¥è©¢å€å¡Šç¾åŒ– */
        .search-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }

        /* æŸ¥è©¢æŒ‰éˆ• */
        .btn-search {
            width: 100%;
        }

        /* è¡¨æ ¼æ¨™é¡Œç½®ä¸­ */
        th {
            text-align: center;
            white-space: nowrap;
        }

        /* ç‰ˆé¢é–“è· */
        .container {
            margin-top: 30px;
            margin-bottom: 50px;
        }
    </style>
    </head>
<body>
<!-- Navbar Start -->
   <th:block th:replace="fragments/bodySection :: bodySection"></th:block>
<!-- Hero Section End -->
<!-- ğŸ”¹ ææ¬¾æŸ¥è©¢è¡¨å–® -->
<div class="container">
    <h3 class="mb-3">æˆ‘è¦ææ¬¾ / ææ¬¾æŸ¥è©¢</h3>

    <div class="search-box">
        <form th:action="@{/dona/donaAddD}" method="post" th:object="${donaReq}">
            <div class="row g-3">
                <!-- æ—¥æœŸé¸æ“‡ -->
                <div class="col-md-4">
                <label class="form-label">è«‹è¼¸å…¥æŸ¥è©¢æ—¥æœŸ</label>
                <div class="input-group">
                    <select class="form-select" name="startYear">
                        <option value="" selected>å¹´</option>
<option th:each="year : ${#numbers.sequence(2000, 2030)}" th:value="${year}" th:text="${year}"></option>                    </select>
                    <select class="form-select" name="startMonth">
                        <option value="" selected>æœˆ</option>
                        <option th:each="month : ${#numbers.sequence(1, 12)}" th:value="${month}" th:text="${month}"></option>
                    </select>
                </div>
            </div>

            <div class="col-md-4">
                <label class="form-label">è‡³</label>
                <div class="input-group">
                    <select class="form-select" name="endYear">
                        <option value="" selected>å¹´</option>
                                                <option th:each="year : ${#numbers.sequence(2000, 2030)}" th:value="${year}" th:text="${year}"></option>

                    </select>
                    <select class="form-select" name="endMonth">
                        <option value="" selected>æœˆ</option>
                                                <option th:each="month : ${#numbers.sequence(1, 12)}" th:value="${month}" th:text="${month}"></option>

                    </select>
                </div>
            </div>

                <!-- ææ¬¾æŠ¬é ­ -->
                <div class="col-md-4">
                     <label class="form-label">ææ¬¾æŠ¬é ­*</label>
                <input type="text" class="form-control" th:field="*{salutation}" placeholder="è«‹è¼¸å…¥ææ¬¾æŠ¬é ­">
                <span th:if="${#fields.hasErrors('salutation')}" th:errors="*{salutation}" class="error"></span>
            </div>
                </div>

                <!-- èº«åˆ†è­‰ -->
                <div class="col-md-4">
                 <label class="form-label">èº«åˆ†è­‰</label>
                <input type="text" class="form-control" th:field="*{idNum}" placeholder="è«‹è¼¸å…¥èº«åˆ†è­‰è™Ÿç¢¼">
                    <span th:if="${#fields.hasErrors('idNum')}" th:errors="*{idNum}" class="error"></span>
                </div>
                
                 <!-- çµ±ç·¨ -->
                <div class="col-md-4">
                  <label class="form-label">çµ±ç·¨</label>
                <input type="text" class="form-control" th:field="*{guiNum}" placeholder="è«‹è¼¸å…¥çµ±ä¸€ç·¨è™Ÿ">
                    <span th:if="${#fields.hasErrors('guiNum')}" th:errors="*{guiNum}" class="error"></span>
                </div>

                <!-- æŸ¥è©¢æŒ‰éˆ• -->
                <div class="col-md-4 align-self-end">
                    <button type="submit" class="btn btn-primary btn-search">æŸ¥è©¢</button>
                </div>
                <div th:if="${errorMessage}" class="alert alert-danger mt-3" role="alert" style="font-weight:bold;">
            <span th:text="${errorMessage}"></span>
        </div>
            </div>
        </form>
    </div>
</div>

<!-- ææ¬¾æŸ¥è©¢çµæœè¡¨æ ¼ -->
<div class="container">
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-primary">
                 <tr>
                    <th scope="col"><input type="checkbox"></th>
                    <th scope="col"><span class="sortable" style="cursor:pointer;" data-column="1" data-type="text" data-sort="none">ææ¬¾æ—¥æœŸ <span class="sort-icon">â†•ï¸</span></span></th>
                    <th scope="col"><span class="sortable" style="cursor:pointer;" data-column="2" data-type="number" data-sort="none">æ”¶æ“šç·¨è™Ÿ <span class="sort-icon">â†•ï¸</span></span></th>
                    <th scope="col">ææ¬¾æŠ¬é ­</th>
                    <th scope="col"><span class="sortable" style="cursor:pointer;" data-column="4" data-type="number" data-sort="none">ææ¬¾é‡‘é¡ <span class="sort-icon">â†•ï¸</span></span></th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="dona : ${donaList}">
                    <td><input type="checkbox"></td>
                    <td th:text="${#dates.format(dona.createdTime, 'yyyy/MM/dd HH:mm')}">YYYY/MM/DD</td>
                    <td th:text="${dona.donationRecordId}">0000001</td>
                    <td th:text="${dona.salutation}">ææ¬¾æŠ¬é ­</td>
                    <td th:text="${dona.donationIncome}">ææ¬¾é‡‘é¡</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<!-- Footer Start -->
<th:block th:replace="fragments/footer :: footer"></th:block>
     <!-- Footer End -->
     
     <!-- Back to Top -->
     <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>
     
     
     <!-- JavaScript Libraries -->
     <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
     <script src="lib/easing/easing.min.js"></script>
     <script src="lib/waypoints/waypoints.min.js"></script>
     <script src="lib/owlcarousel/owl.carousel.min.js"></script>
     <script src="lib/tempusdominus/js/moment.min.js"></script>
     <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
     <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
     
     <!-- Contact Javascript File -->
     <script src="mail/jqBootstrapValidation.min.js"></script>
     <script src="mail/contact.js"></script>
     
     <!-- Template Javascript -->
     <script src="js/main.js"></script>
    

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    let searchButton = document.querySelector(".btn-search");
    let form = document.querySelector("form");
    // **è¡¨æ ¼æ’åºåŠŸèƒ½**
    function sortTable(columnIndex, type, isAscending) {
            let table = document.querySelector("table tbody");
            let rows = Array.from(table.rows);
            rows.sort((a, b) => {
                let cellA = a.cells[columnIndex].innerText.trim();
                let cellB = b.cells[columnIndex].innerText.trim();

                if (type === "number") {
                    cellA = parseFloat(cellA.replace(/,/g, "")) || 0;
                    cellB = parseFloat(cellB.replace(/,/g, "")) || 0;
                } else {
                    cellA = cellA.toLowerCase();
                    cellB = cellB.toLowerCase();
                }

                return isAscending ? (cellA > cellB ? 1 : -1) : (cellA < cellB ? 1 : -1);
            });

            table.innerHTML = "";
            rows.forEach(row => table.appendChild(row));
        }

    document.querySelectorAll(".sortable").forEach(icon => {
        icon.style.cursor = "pointer";
        icon.addEventListener("click", function () {
            let columnIndex = parseInt(this.dataset.column);
            let type = this.dataset.type;
            let sortIcon = this.querySelector(".sort-icon");
            let currentSort = this.dataset.sort;
            let isAscending = currentSort !== "asc";

            document.querySelectorAll(".sortable").forEach(i => {
                i.dataset.sort = "none";
                i.querySelector(".sort-icon").textContent = "â†•ï¸";
            });

            this.dataset.sort = isAscending ? "asc" : "desc";
            sortIcon.textContent = isAscending ? "â–²" : "â–¼";

            sortTable(columnIndex, type, isAscending);
        });
    });

    // **ç¾¤çµ„æ’åºï¼ˆæŒ‰ææ¬¾æŠ¬é ­ï¼‰**
    function groupByColumn(columnIndex) {
        let table = document.querySelector("table tbody");
        let rows = Array.from(table.rows);

        rows.sort((a, b) => {
            let cellA = a.cells[columnIndex].innerText.trim().toLowerCase();
            let cellB = b.cells[columnIndex].innerText.trim().toLowerCase();
            return cellA.localeCompare(cellB);
        });

        table.innerHTML = "";
        rows.forEach(row => table.appendChild(row));
    }

    // **ç¶å®šæ’åºæŒ‰éˆ•**
    document.querySelectorAll(".sortable").forEach(icon => {
        let isAscending = true;
        icon.addEventListener("click", function () {
            let columnIndex = parseInt(this.dataset.column);
            let type = this.dataset.type;
            sortTable(columnIndex, type, isAscending);
            isAscending = !isAscending;
        });
    });

    // **ç¶å®šç¾¤çµ„æ’åºæŒ‰éˆ•**
    let groupByDonorBtn = document.getElementById("groupByDonor");
    if (groupByDonorBtn) {
        groupByDonorBtn.addEventListener("click", function () {
            groupByColumn(3);
        });
    }

    // **è¡¨å–®é©—è­‰**
    function validateForm() {
            let donor = document.getElementById("donor").value.trim();
            let idNum = document.getElementById("idNum").value.trim();
            let guiNum = document.getElementById("guiNum").value.trim();

            if (donor && (idNum || guiNum)) {
                searchButton.removeAttribute("disabled");
                return true;
            } else {
                searchButton.setAttribute("disabled", "true");
                return false;
            }
        }

    // **ç›£è½è¡¨å–®è¼¸å…¥è®ŠåŒ–**
    document.querySelectorAll("#donor, #idNum, #guiNum").forEach(input => {
            input.addEventListener("input", validateForm);
        });


    // **è¡¨å–®æäº¤æª¢æŸ¥**
    form.addEventListener("submit", function (event) {
            if (!validateForm()) {
                event.preventDefault();
                alert("è«‹å¡«å¯«ææ¬¾æŠ¬é ­ï¼Œä¸¦è¼¸å…¥èº«åˆ†è­‰æˆ–çµ±ä¸€ç·¨è™Ÿå…¶ä¸­ä¸€é …ï¼");
            }
        });
    // **åˆå§‹åŒ–æŒ‰éˆ•ç‹€æ…‹**
    validateForm();
});

</script>
        

</body>
</html>