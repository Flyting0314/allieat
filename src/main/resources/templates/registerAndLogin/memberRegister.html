<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">

<head>

<th:block th:replace="fragments/header :: header"></th:block>
<link th:href="@{/css/memberRegister.css}" rel="stylesheet">
<style>

        #pointModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
        }

        #privacyModal .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>

</head>

<body>
    <!-- Navbar Start -->
    <th:block th:replace="fragments/bodySection :: bodySection"></th:block>
    <!-- Hero Section End -->


    <!-- Verification Form Start -->
    <div class="verification_wrapper">
        <div class="verification_container">
            <h1 class="verification_title">受助者註冊</h1>
            <p class="verification_subtitle">以下欄位皆為必填</p>

            <h2 class="verification_section_title">基本資料</h2>
            <form th:action="@{/registerAndLogin/register/member}" th:object="${member}" method="post"
                enctype="multipart/form-data" onsubmit="return validateAgreement()">

                <div class="verification_form_group">
                    <label class="verification_form_label">註冊單位</label>
                    <div class="verification_form_controls">

                        <select class="verification_select" th:field="*{organization.organizationId}"
                            id="organizationSelect" onchange="handleOrgChange(this)">
                            <option value="">請選擇在冊單位</option>
                            <option th:each="org : ${organizations}" th:value="${org.organizationId}"
                                th:text="${org.name}">
                            </option>
                            <option value="-1">其他</option>
                        </select>
                        <div class="text-danger" th:if="${#fields.hasErrors('organization.organizationId')}"
                            th:errors="*{organization.organizationId}"></div>


                    </div>
                </div>
                <div class="verification_form_group">
                    <label class="verification_form_label">姓名</label>
                    <div class="verification_form_controls">
                        <input type="text" th:field="*{name}" class="verification_input">
                        <div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                    </div>
                </div>

                <div class="verification_form_group">
                    <label class="verification_form_label">身份證字號</label>
                    <div class="verification_form_controls">
                        <input type="text" th:field="*{idNum}" class="verification_input">
                        <div class="text-danger" th:if="${#fields.hasErrors('idNum')}" th:errors="*{idNum}"></div>
                    </div>
                </div>


                <div class="verification_form_group">
                    <label class="verification_form_label">戶籍地址</label>
                    <div class="verification_form_controls">
                        <div class="verification_address_group">
                            <select id="permCitySelect" class="verification_select"></select>
                            <select id="permDistrictSelect" class="verification_select"></select>
                            <input type="text" id="permZipcodeInput" class="verification_input" readonly
                                placeholder="郵遞區號" />
                        </div>
                        <input type="text" th:field="*{permAddr}" id="permDetail" class="verification_input"
                            placeholder="請輸入詳細地址" />
                        <div class="text-danger" th:if="${#fields.hasErrors('permAddr')}" th:errors="*{permAddr}"></div>
                    </div>
                </div>


                <div class="verification_form_group">
                    <label class="verification_form_label">通訊地址</label>
                    <div class="verification_form_controls">
                        <div class="verification_address_group">
                            <select id="commCitySelect" class="verification_select"></select>
                            <select id="commDistrictSelect" class="verification_select"></select>
                            <input type="text" id="commZipcodeInput" class="verification_input" readonly
                                placeholder="郵遞區號" />
                        </div>

                        <input type="text" th:field="*{address}" id="commDetail" class="verification_input"
                            placeholder="請輸入詳細地址" />
                        <div class="text-danger" th:if="${#fields.hasErrors('address')}" th:errors="*{address}"></div>

                        <!-- 同上選項：放在詳細地址下方，對齊 -->
                        <div style="margin-top: 14px;">
                            <label style="font-weight: normal; font-size: 14px;">
                                <input type="checkbox" id="sameAsPerm" style="margin-right: 4px;">
                                同上
                            </label>
                        </div>
                    </div>
                </div>


                <div class="verification_form_group">
                    <label class="verification_form_label">電子信箱</label>
                    <div class="verification_form_controls">
                        <input type="email" th:field="*{email}" class="verification_input">
                        <div class="text-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
                    </div>
                </div>

                <div class="verification_form_group">
                    <label class="verification_form_label">聯絡電話</label>
                    <div class="verification_form_controls">
                        <input type="text" th:field="*{phone}" class="verification_input">
                        <div class="text-danger" th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}"></div>
                    </div>
                </div>

                <div class="verification_form_group">
                    <label class="verification_form_label">帳號</label>
                    <div class="verification_form_controls">
                        <input type="text" th:field="*{account}" class="verification_input">
                        <div class="text-danger" th:if="${#fields.hasErrors('account')}" th:errors="*{account}"></div>
                        <div class="text-danger" th:if="${error != null and error.contains('帳號')}" th:text="${error}">
                        </div>
                    </div>
                </div>

                <div class="verification_form_group">
                    <label class="verification_form_label">密碼</label>
                    <div class="verification_form_controls">
                        <input type="password" th:field="*{password}" class="verification_input">
                        <div class="text-danger" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
                    </div>
                </div>

                <!-- 上傳文件欄位 -->
                <div class="verification_form_group">
                    <label class="verification_form_label">上傳證明文件</label>
                    <div class="verification_form_controls">
                        <input type="file" name="kycFile" class="form-control" />
                        <div class="kyc-preview-container">
                            <div th:if="${member.kycImage != null}">
                                <a th:href="@{'/member/' + ${member.kycImage}}" target="_blank">點此預覽上傳檔案</a>
                                <img th:if="${#strings.contains(member.kycImage, '.png') or #strings.contains(member.kycImage, '.jpg') or #strings.contains(member.kycImage, '.jpeg')}"
                                    th:src="@{'/member/' + ${member.kycImage}}"
                                    style="max-width: 200px; margin-top: 10px;">
                            </div>
                        </div>
                        <div id="kycError" class="text-danger"
                            th:if="${hasSubmitted} and ${error != null and error.contains('檔案')}" th:text="${error}">
                        </div>
                    </div>


                </div>

                <!-- 愛心點數使用說明 -->
                <div class="verification_form_group" style="flex-direction: column;">
                    <label class="verification_form_label"></label>
                    <div class="verification_form_controls">
                        <label>
                            <input type="checkbox" id="agreePoint">
                            您已了解並同意本平台依「<a href='#' id="viewPointNotice">愛心點數使用說明</a>」
                            發送與管理捐款轉換之點數，供您於合作店家兌換待用餐點等公益服務。
                        </label>
                    </div>
                </div>

                <!-- 個資運用告知聲明 -->
                <div class="verification_form_group" style="flex-direction: column;">
                    <label class="verification_form_label"></label>
                    <div class="verification_form_controls">
                        <label>
                            <input type="checkbox" id="agreeCheck" name="agreeCheck" onclick="return false">
                            您已了解並同意本平台蒐集、處理及使用您的個人資料。請閱讀
                            「<a href="#" id="viewPrivacyNotice">個資運用告知聲明</a>」
                        </label>
                        <input type="hidden" name="agreedToTerms" id="agreedToTerms" value="false">
                    </div>
                </div>

                <!-- <div id="errorMessage" class="text-danger" th:classappend="${errorMessage} ? '' : 'hidden'" th:text="${errorMessage}"></div> -->
                <div id="errorMessage" class="text-danger" th:if="${errorMessage}" th:text="${errorMessage}"></div>




                <div class="verification_button_container">
                    <button type="button" class="verification_back_btn"
                        th:onclick="|location.href='@{/registerAndLogin/register}'|">上一頁</button>
                    <button type="submit" class="verification_next_btn">下一步</button>
                </div>
            </form>
        </div>
    </div>
    <!-- 愛心點數燈箱 -->
    <div id="pointModal" class="modal" style="display:none">
        <div class="modal-content" style="">
            <h3>愛心點數使用說明</h3>
            <p>(一)什麼是愛心點數？
                <br>愛心點數是由攏呷霸愛心平台(以下稱本平台)根據捐款人所捐贈之金額，一比一轉換後所發放的公益點數。點數將由本平台核發至受助者的會員帳號中，供其使用。
            </p>

            <p>(二)用途與使用方式
                <br>愛心點數可用於兌換本平台合作店家所提供的待用餐點。受助者可於指定合作店家出示會員資訊，或是透過本平台選擇兌換項目。
            </p>
            
            <p>(三)點數有效期限
                <br>愛心點數自核發日起計算，有效期限為 【6個月】，逾期未使用將自動失效，點數將回收後重新分配予其他有需要的對象。
            </p>
            
            <p>(四)注意事項
                <br> 1.愛心點數僅限受助者本人使用，不得轉讓、轉售、兌現或作為任何商業用途。
                <br>2.如發現重複申請、冒用身份、非法兌換或其他違規情事，平台有權取消點數與帳號資格。
                <br>3.點數兌換服務之合作店家、兌換方式與使用規則，將依平台公告內容為準，並得隨時調整。
            </p>
            
            <p>(五)其他說明
                <br>為保障所有受助者的權益，請務必妥善使用愛心點數，並配合平台相關規定，共同維護資源的公平與透明。
            </p>
            
            <div style="margin-top: 20px; text-align: center;">
                <button onclick="closePrivacyLightbox()" class="df-button df-button-next"
                    style="width: 150px;">關閉</button>
            </div>
        </div>
    </div>

    <!-- 個資燈箱 -->
    <div id="privacyModal" class="modal"
        style="display:none; position: fixed; top: 0; left: 0;
    width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000;">
        <div class="modal-content"
            style="background: white; padding: 20px; border-radius: 8px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <h3>個資運用告知聲明</h3>

            <p>感謝您使用攏呷霸愛心平台(以下稱本平台)，為了保障您的權益，請您詳細閱讀以下說明：</p>

            <p>一、蒐集、處理及利用之目的：
                <br>本平台將蒐集您的個人資料，主要用途包括：
                <br>◆ 辦理受助者身份驗證與資格審核
                <br>◆ 發送通知、聯繫相關事宜
                <br>◆ 提供餐點兌換、物資配送、其他公益服務
                <br>◆ 作為政府機關或主管機關依法要求提供資訊之依據
            </p>

            <p>二、蒐集、處理及利用之個人資料類別：
                <br>包含：姓名、身分證字號／統一編號、出生日期、性別、電子郵件、聯絡電話、戶籍及通訊地址、弱勢證明或其他相關佐證文件影本等。
            </p>

            <p>三、個人資料利用之期間、地區、對象及方式：
                <br>(一)期間：於本平台提供服務期間及依法律要求之保存年限內。
                <br>(二)地區：本國及與本平台有業務往來之國內外機構營業處所所在地。
                <br>(三)對象：本平台內部相關單位、合作店家、配合之公益／社福團體及依法具有調查權限之機關。
                <br>(四)方式：以自動化系統或非自動方式依誠信原則進行蒐集、處理及利用。
            </p>

            <p>四、資料使用對象與範圍：
                <br>您所提供之個人資料僅限於本平台內部作業與合作公益服務之必要用途，不會對外揭露或提供給非合作第三方，除非依法律規定或司法機關正式要求辦理。
            </p>

            <p>五、當事人依法享有之權利：
                <br>依據個人資料保護法，您有權查詢、閱覽、複製、補充、更正、刪除您的個人資料，或要求停止蒐集、處理或利用。如欲行使上述權利，請與本平台聯繫。
            </p>

            <p>六、拒絕提供個人資料之影響：
                <br>您有權選擇是否提供資料，惟若未提供必要之資訊，將可能影響您申請受助者身份、點數發放與後續服務提供之完整性。
            </p>

            <p>七、個人資料之安全維護
                <br>本平台將依內部資訊安全規範與相關法令，採取適當技術與管理措施，妥善保存並保障您的個人資料安全，避免未經授權之存取、洩露、變更或損毀。
            </p>

            <div style="margin-top: 20px; text-align: center;">
                <button onclick="closePrivacyLightbox()" class="df-button df-button-next"
                    style="width: 150px;">關閉</button>
            </div>
        </div>
    </div>

    <!-- Verification Form End -->

    <!-- Footer Start -->
    <th:block th:replace="fragments/footer :: footer"></th:block>
    <!-- Footer End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Contact Javascript File -->
    <script src="mail/jqBootstrapValidation.min.js"></script>
    <script src="mail/contact.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <!-- Form Script -->





    <script>
        document.addEventListener('DOMContentLoaded', function () {

            //  預覽與錯誤清除
            const fileInput = document.querySelector('input[name="kycFile"]');
            const previewContainer = document.querySelector('.kyc-preview-container');
            const kycError = document.getElementById('kycError');

            if (fileInput && previewContainer) {
                fileInput.addEventListener('change', function () {
                    previewContainer.innerHTML = '';
                    const file = fileInput.files[0];
                    if (!file) return;

                    const fileURL = URL.createObjectURL(file);
                    const extension = file.name.split('.').pop().toLowerCase();

                    const link = document.createElement('a');
                    link.href = fileURL;
                    link.target = '_blank';
                    link.textContent = '點此預覽上傳檔案';
                    previewContainer.appendChild(link);

                    if (['png', 'jpg', 'jpeg'].includes(extension)) {
                        const img = document.createElement('img');
                        img.src = fileURL;
                        img.alt = '預覽圖';
                        img.style.maxWidth = '200px';
                        img.style.marginTop = '10px';
                        previewContainer.appendChild(img);
                    }

                    if (kycError) {
                        kycError.style.display = 'none';
                    }
                });
            }

            // 須知
            const agreeCheck = document.getElementById('agreeCheck');
            const viewNotice = document.getElementById('viewNotice');
            const noticeModal = document.getElementById('noticeModal');
            const noticeAgree = document.getElementById('noticeAgree');
            const agreeNotice = document.getElementById('agreeNotice');
            const closeNotice = document.getElementById('closeNotice');
            const agreedToTerms = document.getElementById('agreedToTerms');
            const errorMessage = document.getElementById('errorMessage');

            if (viewNotice) {
                viewNotice.addEventListener('click', function (e) {
                    e.preventDefault();
                    noticeModal.style.display = 'flex';
                    noticeAgree.checked = agreeCheck.checked;
                });
            }

            if (agreeNotice) {
                agreeNotice.addEventListener('click', function () {
                    if (noticeAgree.checked) {
                        agreeCheck.checked = true;
                        agreedToTerms.value = 'true';
                        noticeModal.style.display = 'none';
                        if (errorMessage) errorMessage.classList.add("hidden");
                    } else {
                        alert('請勾選同意使用須知');
                    }
                });
            }

            if (closeNotice) {
                closeNotice.addEventListener('click', function () {
                    noticeModal.style.display = 'none';
                    noticeAgree.checked = false;
                });
            }

            // 輸入清除錯誤
            document.querySelectorAll('.verification_input').forEach(input => {
                input.addEventListener('input', function () {
                    const errorDiv = input.parentElement.querySelector('.text-danger');
                    if (errorDiv) {
                        errorDiv.style.display = 'none';
                    }
                });
            });

            //在冊單位 select 切換清除錯誤
            const organizationSelect = document.getElementById("organizationSelect");
            if (organizationSelect) {
                organizationSelect.addEventListener("change", function () {
                    const errorDiv = organizationSelect.parentElement.querySelector('.text-danger');
                    if (errorDiv) errorDiv.style.display = 'none';
                });
            }
            const select = document.getElementById("organizationSelect");
            if (select && select.value === "-1") {
                document.getElementById("otherOrganizationInput").style.display = "block";
            }
        });

        function handleOrgChange(selectElement) {
            const selectedValue = selectElement.value;
            const hiddenField = document.getElementById("organizationIdField");
            const otherInput = document.getElementById("otherOrganizationInput");

            hiddenField.value = selectedValue;

            if (selectedValue === "-1") {
                otherInput.style.display = "block";
            } else {
                otherInput.style.display = "none";
            }
        }
        document.getElementById("organizationSelect").addEventListener("change", function () {
            const errorDiv = document.getElementById("orgErrorMessage");
            if (errorDiv) {
                errorDiv.style.display = "none";
            }
        });

        function setupAddressSelect(cityId, districtId, zipId) {
            const citySelect = document.getElementById(cityId);
            const districtSelect = document.getElementById(districtId);
            const zipInput = document.getElementById(zipId);

            // 載入縣市
            addrData.forEach(item => {
                const option = document.createElement('option');
                option.value = item.city;
                option.textContent = item.city;
                citySelect.appendChild(option);
            });

            // 載入預設值
            const selectedCity = citySelect.value;
            const selectedDistrict = districtSelect.value;
            if (selectedCity) {
                const cityObj = addrData.find(item => item.city === selectedCity);
                if (cityObj) {
                    districtSelect.innerHTML = '<option value="">請選擇鄉鎮市區</option>';
                    cityObj.area.forEach(area => {
                        const option = document.createElement('option');
                        option.value = area.name;
                        option.textContent = area.name;
                        if (area.name === selectedDistrict) option.selected = true;
                        districtSelect.appendChild(option);
                    });
                    const zipObj = cityObj.area.find(area => area.name === selectedDistrict);
                    if (zipObj) zipInput.value = zipObj.zipcode;
                }
            }

            // 選縣市時 → 自動填入第一區並帶入郵遞區號
            citySelect.addEventListener('change', () => {
                const selectedCity = citySelect.value;
                const cityObj = addrData.find(item => item.city === selectedCity);
                districtSelect.innerHTML = '<option value="">請選擇鄉鎮市區</option>';
                zipInput.value = '';
                if (cityObj && cityObj.area.length > 0) {
                    cityObj.area.forEach((area, index) => {
                        const option = document.createElement('option');
                        option.value = area.name;
                        option.textContent = area.name;
                        if (index === 0) {
                            option.selected = true;
                            zipInput.value = area.zipcode;
                        }
                        districtSelect.appendChild(option);
                    });
                }
            });

            // 選鄉鎮時 → 填入郵遞區號
            districtSelect.addEventListener('change', () => {
                const selectedCity = citySelect.value;
                const selectedDistrict = districtSelect.value;
                const cityObj = addrData.find(item => item.city === selectedCity);
                if (cityObj) {
                    const areaObj = cityObj.area.find(area => area.name === selectedDistrict);
                    zipInput.value = areaObj ? areaObj.zipcode : '';
                } else {
                    zipInput.value = '';
                }
            });
        }

        // 呼叫：DOM 加載完就啟用
        window.addEventListener('DOMContentLoaded', () => {
            setupAddressSelect("permCitySelect", "permDistrictSelect", "permZipcodeInput");
            setupAddressSelect("commCitySelect", "commDistrictSelect", "commZipcodeInput");
        });

        // 縣市、區域、郵遞區號對應資料
        const addrData = [
            {
                "city": "臺北市",
                "area": [
                    { "name": "中正區", "zipcode": "100" },
                    { "name": "大同區", "zipcode": "103" },
                    { "name": "中山區", "zipcode": "104" },
                    { "name": "松山區", "zipcode": "105" },
                    { "name": "大安區", "zipcode": "106" },
                    { "name": "萬華區", "zipcode": "108" },
                    { "name": "信義區", "zipcode": "110" },
                    { "name": "士林區", "zipcode": "111" },
                    { "name": "北投區", "zipcode": "112" },
                    { "name": "內湖區", "zipcode": "114" },
                    { "name": "南港區", "zipcode": "115" },
                    { "name": "文山區", "zipcode": "116" }
                ]
            },
            {
                "city": "基隆市",
                "area": [
                    { "name": "仁愛區", "zipcode": "200" },
                    { "name": "信義區", "zipcode": "201" },
                    { "name": "中正區", "zipcode": "202" },
                    { "name": "中山區", "zipcode": "203" },
                    { "name": "安樂區", "zipcode": "204" },
                    { "name": "暖暖區", "zipcode": "205" },
                    { "name": "七堵區", "zipcode": "206" }
                ]
            },
            {
                "city": "新北市",
                "area": [
                    { "name": "萬里區", "zipcode": "207" },
                    { "name": "金山區", "zipcode": "208" },
                    { "name": "板橋區", "zipcode": "220" },
                    { "name": "汐止區", "zipcode": "221" },
                    { "name": "深坑區", "zipcode": "222" },
                    { "name": "石碇區", "zipcode": "223" },
                    { "name": "瑞芳區", "zipcode": "224" },
                    { "name": "平溪區", "zipcode": "226" },
                    { "name": "雙溪區", "zipcode": "227" },
                    { "name": "貢寮區", "zipcode": "228" },
                    { "name": "新店區", "zipcode": "231" },
                    { "name": "坪林區", "zipcode": "232" },
                    { "name": "烏來區", "zipcode": "233" },
                    { "name": "永和區", "zipcode": "234" },
                    { "name": "中和區", "zipcode": "235" },
                    { "name": "土城區", "zipcode": "236" },
                    { "name": "三峽區", "zipcode": "237" },
                    { "name": "樹林區", "zipcode": "238" },
                    { "name": "鶯歌區", "zipcode": "239" },
                    { "name": "三重區", "zipcode": "241" },
                    { "name": "新莊區", "zipcode": "242" },
                    { "name": "泰山區", "zipcode": "243" },
                    { "name": "林口區", "zipcode": "244" },
                    { "name": "蘆洲區", "zipcode": "247" },
                    { "name": "五股區", "zipcode": "248" },
                    { "name": "八里區", "zipcode": "249" },
                    { "name": "淡水區", "zipcode": "251" },
                    { "name": "三芝區", "zipcode": "252" },
                    { "name": "石門區", "zipcode": "253" }
                ]
            },
            {
                "city": "宜蘭縣",
                "area": [
                    { "name": "宜蘭", "zipcode": "260" },
                    { "name": "頭城", "zipcode": "261" },
                    { "name": "礁溪", "zipcode": "262" },
                    { "name": "壯圍", "zipcode": "263" },
                    { "name": "員山", "zipcode": "264" },
                    { "name": "羅東", "zipcode": "265" },
                    { "name": "三星", "zipcode": "266" },
                    { "name": "大同", "zipcode": "267" },
                    { "name": "五結", "zipcode": "268" },
                    { "name": "冬山", "zipcode": "269" },
                    { "name": "蘇澳", "zipcode": "270" },
                    { "name": "南澳", "zipcode": "272" },
                    { "name": "釣魚臺列嶼", "zipcode": "290" }
                ]
            },
            {
                "city": "新竹市",
                "area": [
                    { "name": "", "zipcode": "300" }
                ]
            },
            {
                "city": "新竹縣",
                "area": [
                    { "name": "竹北", "zipcode": "302" },
                    { "name": "湖口", "zipcode": "303" },
                    { "name": "新豐", "zipcode": "304" },
                    { "name": "新埔", "zipcode": "305" },
                    { "name": "關西", "zipcode": "306" },
                    { "name": "芎林", "zipcode": "307" },
                    { "name": "寶山", "zipcode": "308" },
                    { "name": "竹東", "zipcode": "310" },
                    { "name": "五峰", "zipcode": "311" },
                    { "name": "橫山", "zipcode": "312" },
                    { "name": "尖石", "zipcode": "313" },
                    { "name": "北埔", "zipcode": "314" },
                    { "name": "峨眉", "zipcode": "315" }
                ]
            },
            {
                "city": "桃園市",
                "area": [
                    { "name": "中壢區", "zipcode": "320" },
                    { "name": "平鎮區", "zipcode": "324" },
                    { "name": "龍潭區", "zipcode": "325" },
                    { "name": "楊梅區", "zipcode": "326" },
                    { "name": "新屋區", "zipcode": "327" },
                    { "name": "觀音區", "zipcode": "328" },
                    { "name": "桃園區", "zipcode": "330" },
                    { "name": "龜山區", "zipcode": "333" },
                    { "name": "八德區", "zipcode": "334" },
                    { "name": "大溪區", "zipcode": "335" },
                    { "name": "復興區", "zipcode": "336" },
                    { "name": "大園區", "zipcode": "337" },
                    { "name": "蘆竹區", "zipcode": "338" }
                ]
            },
            {
                "city": "苗栗縣",
                "area": [
                    { "name": "竹南", "zipcode": "350" },
                    { "name": "頭份", "zipcode": "351" },
                    { "name": "三灣", "zipcode": "352" },
                    { "name": "南庄", "zipcode": "353" },
                    { "name": "獅潭", "zipcode": "354" },
                    { "name": "後龍", "zipcode": "356" },
                    { "name": "通霄", "zipcode": "357" },
                    { "name": "苑裡", "zipcode": "358" },
                    { "name": "苗栗", "zipcode": "360" },
                    { "name": "造橋", "zipcode": "361" },
                    { "name": "頭屋", "zipcode": "362" },
                    { "name": "公館", "zipcode": "363" },
                    { "name": "大湖", "zipcode": "364" },
                    { "name": "泰安", "zipcode": "365" },
                    { "name": "銅鑼", "zipcode": "366" },
                    { "name": "三義", "zipcode": "367" },
                    { "name": "西湖", "zipcode": "368" },
                    { "name": "卓蘭", "zipcode": "369" }
                ]
            },
            {
                "city": "臺中市",
                "area": [
                    { "name": "中區", "zipcode": "400" },
                    { "name": "東區", "zipcode": "401" },
                    { "name": "南區", "zipcode": "402" },
                    { "name": "西區", "zipcode": "403" },
                    { "name": "北區", "zipcode": "404" },
                    { "name": "北屯區", "zipcode": "406" },
                    { "name": "西屯區", "zipcode": "407" },
                    { "name": "南屯區", "zipcode": "408" },
                    { "name": "太平區", "zipcode": "411" },
                    { "name": "大里區", "zipcode": "412" },
                    { "name": "霧峰區", "zipcode": "413" },
                    { "name": "烏日區", "zipcode": "414" },
                    { "name": "豐原區", "zipcode": "420" },
                    { "name": "后里區", "zipcode": "421" },
                    { "name": "石岡區", "zipcode": "422" },
                    { "name": "東勢區", "zipcode": "423" },
                    { "name": "和平區", "zipcode": "424" },
                    { "name": "新社區", "zipcode": "426" },
                    { "name": "潭子區", "zipcode": "427" },
                    { "name": "大雅區", "zipcode": "428" },
                    { "name": "神岡區", "zipcode": "429" },
                    { "name": "大肚區", "zipcode": "432" },
                    { "name": "沙鹿區", "zipcode": "433" },
                    { "name": "龍井區", "zipcode": "434" },
                    { "name": "梧棲區", "zipcode": "435" },
                    { "name": "清水區", "zipcode": "436" },
                    { "name": "大甲區", "zipcode": "437" },
                    { "name": "外埔區", "zipcode": "438" },
                    { "name": "大安區", "zipcode": "439" }
                ]
            },
            {
                "city": "彰化縣",
                "area": [
                    { "name": "彰化", "zipcode": "500" },
                    { "name": "芬園", "zipcode": "502" },
                    { "name": "花壇", "zipcode": "503" },
                    { "name": "秀水", "zipcode": "504" },
                    { "name": "鹿港", "zipcode": "505" },
                    { "name": "福興", "zipcode": "506" },
                    { "name": "線西", "zipcode": "507" },
                    { "name": "和美", "zipcode": "508" },
                    { "name": "伸港", "zipcode": "509" },
                    { "name": "員林", "zipcode": "510" },
                    { "name": "社頭", "zipcode": "511" },
                    { "name": "永靖", "zipcode": "512" },
                    { "name": "埔心", "zipcode": "513" },
                    { "name": "溪湖", "zipcode": "514" },
                    { "name": "大村", "zipcode": "515" },
                    { "name": "埔鹽", "zipcode": "516" },
                    { "name": "田中", "zipcode": "520" },
                    { "name": "北斗", "zipcode": "521" },
                    { "name": "田尾", "zipcode": "522" },
                    { "name": "埤頭", "zipcode": "523" },
                    { "name": "溪州", "zipcode": "524" },
                    { "name": "竹塘", "zipcode": "525" },
                    { "name": "二林", "zipcode": "526" },
                    { "name": "大城", "zipcode": "527" },
                    { "name": "芳苑", "zipcode": "528" },
                    { "name": "二水", "zipcode": "530" }
                ]
            },
            {
                "city": "南投縣",
                "area": [
                    { "name": "南投", "zipcode": "540" },
                    { "name": "中寮", "zipcode": "541" },
                    { "name": "草屯", "zipcode": "542" },
                    { "name": "國姓", "zipcode": "544" },
                    { "name": "埔里", "zipcode": "545" },
                    { "name": "仁愛", "zipcode": "546" },
                    { "name": "名間", "zipcode": "551" },
                    { "name": "集集", "zipcode": "552" },
                    { "name": "水里", "zipcode": "553" },
                    { "name": "魚池", "zipcode": "555" },
                    { "name": "信義", "zipcode": "556" },
                    { "name": "竹山", "zipcode": "557" },
                    { "name": "鹿谷", "zipcode": "558" }
                ]
            },
            {
                "city": "嘉義市",
                "area": [
                    { "name": "", "zipcode": "600" }
                ]
            },
            {
                "city": "嘉義縣",
                "area": [
                    { "name": "番路", "zipcode": "602" },
                    { "name": "梅山", "zipcode": "603" },
                    { "name": "竹崎", "zipcode": "604" },
                    { "name": "阿里山", "zipcode": "605" },
                    { "name": "中埔", "zipcode": "606" },
                    { "name": "大埔", "zipcode": "607" },
                    { "name": "水上", "zipcode": "608" },
                    { "name": "鹿草", "zipcode": "611" },
                    { "name": "太保", "zipcode": "612" },
                    { "name": "朴子", "zipcode": "613" },
                    { "name": "東石", "zipcode": "614" },
                    { "name": "六腳", "zipcode": "615" },
                    { "name": "新港", "zipcode": "616" },
                    { "name": "民雄", "zipcode": "621" },
                    { "name": "大林", "zipcode": "622" },
                    { "name": "溪口", "zipcode": "623" },
                    { "name": "義竹", "zipcode": "624" },
                    { "name": "布袋", "zipcode": "625" }
                ]
            },
            {
                "city": "雲林縣",
                "area": [
                    { "name": "斗南", "zipcode": "630" },
                    { "name": "大埤", "zipcode": "631" },
                    { "name": "虎尾", "zipcode": "632" },
                    { "name": "土庫", "zipcode": "633" },
                    { "name": "褒忠", "zipcode": "634" },
                    { "name": "東勢", "zipcode": "635" },
                    { "name": "臺西", "zipcode": "636" },
                    { "name": "崙背", "zipcode": "637" },
                    { "name": "麥寮", "zipcode": "638" },
                    { "name": "斗六", "zipcode": "640" },
                    { "name": "林內", "zipcode": "643" },
                    { "name": "古坑", "zipcode": "646" },
                    { "name": "莿桐", "zipcode": "647" },
                    { "name": "西螺", "zipcode": "648" },
                    { "name": "二崙", "zipcode": "649" },
                    { "name": "北港", "zipcode": "651" },
                    { "name": "水林", "zipcode": "652" },
                    { "name": "口湖", "zipcode": "653" },
                    { "name": "四湖", "zipcode": "654" },
                    { "name": "元長", "zipcode": "655" }
                ]
            },
            {
                "city": "臺南市",
                "area": [
                    { "name": "中西區", "zipcode": "700" },
                    { "name": "東區", "zipcode": "701" },
                    { "name": "南區", "zipcode": "702" },
                    { "name": "北區", "zipcode": "704" },
                    { "name": "安平區", "zipcode": "708" },
                    { "name": "安南區", "zipcode": "709" },
                    { "name": "永康區", "zipcode": "710" },
                    { "name": "歸仁區", "zipcode": "711" },
                    { "name": "新化區", "zipcode": "712" },
                    { "name": "左鎮區", "zipcode": "713" },
                    { "name": "玉井區", "zipcode": "714" },
                    { "name": "楠西區", "zipcode": "715" },
                    { "name": "南化區", "zipcode": "716" },
                    { "name": "仁德區", "zipcode": "717" },
                    { "name": "關廟區", "zipcode": "718" },
                    { "name": "龍崎區", "zipcode": "719" },
                    { "name": "官田區", "zipcode": "720" },
                    { "name": "麻豆區", "zipcode": "721" },
                    { "name": "佳里區", "zipcode": "722" },
                    { "name": "西港區", "zipcode": "723" },
                    { "name": "七股區", "zipcode": "724" },
                    { "name": "將軍區", "zipcode": "725" },
                    { "name": "學甲區", "zipcode": "726" },
                    { "name": "北門區", "zipcode": "727" },
                    { "name": "新營區", "zipcode": "730" },
                    { "name": "後壁區", "zipcode": "731" },
                    { "name": "白河區", "zipcode": "732" },
                    { "name": "東山區", "zipcode": "733" },
                    { "name": "六甲區", "zipcode": "734" },
                    { "name": "下營區", "zipcode": "735" },
                    { "name": "柳營區", "zipcode": "736" },
                    { "name": "鹽水區", "zipcode": "737" },
                    { "name": "善化區", "zipcode": "741" },
                    { "name": "大內區", "zipcode": "742" },
                    { "name": "山上區", "zipcode": "743" },
                    { "name": "新市區", "zipcode": "744" },
                    { "name": "安定區", "zipcode": "745" }
                ]
            },
            {
                "city": "高雄市",
                "area": [
                    { "name": "新興區", "zipcode": "800" },
                    { "name": "前金區", "zipcode": "801" },
                    { "name": "苓雅區", "zipcode": "802" },
                    { "name": "鹽埕區", "zipcode": "803" },
                    { "name": "鼓山區", "zipcode": "804" },
                    { "name": "旗津區", "zipcode": "805" },
                    { "name": "前鎮區", "zipcode": "806" },
                    { "name": "三民區", "zipcode": "807" },
                    { "name": "楠梓區", "zipcode": "811" },
                    { "name": "小港區", "zipcode": "812" },
                    { "name": "左營區", "zipcode": "813" },
                    { "name": "仁武區", "zipcode": "814" },
                    { "name": "大社區", "zipcode": "815" },
                    { "name": "岡山區", "zipcode": "820" },
                    { "name": "路竹區", "zipcode": "821" },
                    { "name": "阿蓮區", "zipcode": "822" },
                    { "name": "田寮區", "zipcode": "823" },
                    { "name": "燕巢區", "zipcode": "824" },
                    { "name": "橋頭區", "zipcode": "825" },
                    { "name": "梓官區", "zipcode": "826" },
                    { "name": "彌陀區", "zipcode": "827" },
                    { "name": "永安區", "zipcode": "828" },
                    { "name": "湖內區", "zipcode": "829" },
                    { "name": "鳳山區", "zipcode": "830" },
                    { "name": "大寮區", "zipcode": "831" },
                    { "name": "林園區", "zipcode": "832" },
                    { "name": "鳥松區", "zipcode": "833" },
                    { "name": "大樹區", "zipcode": "840" },
                    { "name": "旗山區", "zipcode": "842" },
                    { "name": "美濃區", "zipcode": "843" },
                    { "name": "六龜區", "zipcode": "844" },
                    { "name": "內門區", "zipcode": "845" },
                    { "name": "杉林區", "zipcode": "846" },
                    { "name": "甲仙區", "zipcode": "847" },
                    { "name": "桃源區", "zipcode": "848" },
                    { "name": "那瑪夏區", "zipcode": "849" },
                    { "name": "茂林區", "zipcode": "851" },
                    { "name": "茄萣區", "zipcode": "852" }
                ]
            },
            {
                "city": "南海諸島",
                "area": [
                    { "name": "東沙", "zipcode": "817" },
                    { "name": "南沙", "zipcode": "819" }
                ]
            },
            {
                "city": "澎湖縣",
                "area": [
                    { "name": "馬公", "zipcode": "880" },
                    { "name": "西嶼", "zipcode": "881" },
                    { "name": "望安", "zipcode": "882" },
                    { "name": "七美", "zipcode": "883" },
                    { "name": "白沙", "zipcode": "884" },
                    { "name": "湖西", "zipcode": "885" }
                ]
            },
            {
                "city": "屏東縣",
                "area": [
                    { "name": "屏東", "zipcode": "900" },
                    { "name": "三地門", "zipcode": "901" },
                    { "name": "霧臺", "zipcode": "902" },
                    { "name": "瑪家", "zipcode": "903" },
                    { "name": "九如", "zipcode": "904" },
                    { "name": "里港", "zipcode": "905" },
                    { "name": "高樹", "zipcode": "906" },
                    { "name": "鹽埔", "zipcode": "907" },
                    { "name": "長治", "zipcode": "908" },
                    { "name": "麟洛", "zipcode": "909" },
                    { "name": "竹田", "zipcode": "911" },
                    { "name": "內埔", "zipcode": "912" },
                    { "name": "萬丹", "zipcode": "913" },
                    { "name": "潮州", "zipcode": "920" },
                    { "name": "泰武", "zipcode": "921" },
                    { "name": "來義", "zipcode": "922" },
                    { "name": "萬巒", "zipcode": "923" },
                    { "name": "崁頂", "zipcode": "924" },
                    { "name": "新埤", "zipcode": "925" },
                    { "name": "南州", "zipcode": "926" },
                    { "name": "林邊", "zipcode": "927" },
                    { "name": "東港", "zipcode": "928" },
                    { "name": "琉球", "zipcode": "929" },
                    { "name": "佳冬", "zipcode": "931" },
                    { "name": "新園", "zipcode": "932" },
                    { "name": "枋寮", "zipcode": "940" },
                    { "name": "枋山", "zipcode": "941" },
                    { "name": "春日", "zipcode": "942" },
                    { "name": "獅子", "zipcode": "943" },
                    { "name": "車城", "zipcode": "944" },
                    { "name": "牡丹", "zipcode": "945" },
                    { "name": "恆春", "zipcode": "946" },
                    { "name": "滿州", "zipcode": "947" }
                ]
            },
            {
                "city": "臺東縣",
                "area": [
                    { "name": "臺東", "zipcode": "950" },
                    { "name": "綠島", "zipcode": "951" },
                    { "name": "蘭嶼", "zipcode": "952" },
                    { "name": "延平", "zipcode": "953" },
                    { "name": "卑南", "zipcode": "954" },
                    { "name": "鹿野", "zipcode": "955" },
                    { "name": "關山", "zipcode": "956" },
                    { "name": "海端", "zipcode": "957" },
                    { "name": "池上", "zipcode": "958" },
                    { "name": "東河", "zipcode": "959" },
                    { "name": "成功", "zipcode": "961" },
                    { "name": "長濱", "zipcode": "962" },
                    { "name": "太麻里", "zipcode": "963" },
                    { "name": "金峰", "zipcode": "964" },
                    { "name": "大武", "zipcode": "965" },
                    { "name": "達仁", "zipcode": "966" }
                ]
            },
            {
                "city": "花蓮縣",
                "area": [
                    { "name": "花蓮", "zipcode": "970" },
                    { "name": "新城", "zipcode": "971" },
                    { "name": "秀林", "zipcode": "972" },
                    { "name": "吉安", "zipcode": "973" },
                    { "name": "壽豐", "zipcode": "974" },
                    { "name": "鳳林", "zipcode": "975" },
                    { "name": "光復", "zipcode": "976" },
                    { "name": "豐濱", "zipcode": "977" },
                    { "name": "瑞穗", "zipcode": "978" },
                    { "name": "萬榮", "zipcode": "979" },
                    { "name": "玉里", "zipcode": "981" },
                    { "name": "卓溪", "zipcode": "982" },
                    { "name": "富里", "zipcode": "983" }
                ]
            },
            {
                "city": "金門縣",
                "area": [
                    { "name": "金沙", "zipcode": "890" },
                    { "name": "金湖", "zipcode": "891" },
                    { "name": "金寧", "zipcode": "892" },
                    { "name": "金城", "zipcode": "893" },
                    { "name": "烈嶼", "zipcode": "894" },
                    { "name": "烏坵", "zipcode": "896" }
                ]
            },
            {
                "city": "連江縣",
                "area": [
                    { "name": "南竿", "zipcode": "209" },
                    { "name": "北竿", "zipcode": "210" },
                    { "name": "莒光", "zipcode": "211" },
                    { "name": "東引", "zipcode": "212" }
                ]
            }
        ];

        const citySelect = document.getElementById('citySelect');
        const districtSelect = document.getElementById('districtSelect');
        const zipInput = document.getElementById('zipcodeInput');



        document.getElementById('sameAsPerm').addEventListener('change', function () {
            const isChecked = this.checked;

            // 戶籍欄位
            const permCity = document.getElementById('permCitySelect').value;
            const permDistrict = document.getElementById('permDistrictSelect').value;
            const permZipcode = document.getElementById('permZipcodeInput').value;
            const permDetail = document.getElementById('permDetail').value;

            // 通訊欄位
            const commCitySelect = document.getElementById('commCitySelect');
            const commDistrictSelect = document.getElementById('commDistrictSelect');
            const commZipcodeInput = document.getElementById('commZipcodeInput');
            const commDetailInput = document.getElementById('commDetail');

            if (isChecked) {
                // 套用戶籍地址值
                commCitySelect.value = permCity;
                commCitySelect.dispatchEvent(new Event('change')); // 觸發縣市改變事件
                setTimeout(() => {
                    commDistrictSelect.value = permDistrict;
                    commDistrictSelect.dispatchEvent(new Event('change'));
                }, 100); // 等待鄉鎮更新完才選擇

                commZipcodeInput.value = permZipcode;
                commDetailInput.value = permDetail;

                // 鎖定欄位
                commCitySelect.disabled = true;
                commDistrictSelect.disabled = true;
                commZipcodeInput.disabled = true;
                commDetailInput.readOnly = true;
            } else {
                // 清除並解鎖
                commCitySelect.disabled = false;
                commDistrictSelect.disabled = false;
                commZipcodeInput.disabled = false;
                commDetailInput.readOnly = false;
            }
        });

        // 愛心點數燈箱控制
        const viewPointNotice = document.getElementById('viewPointNotice');
        const pointModal = document.getElementById('pointModal');
        const agreePoint = document.getElementById('agreePoint');
        const pointAgree = document.getElementById('pointAgree');
        const agreePointBtn = document.getElementById('agreePointBtn');
        const closePoint = document.getElementById('closePoint');

        viewPointNotice.addEventListener('click', function (e) {
            e.preventDefault();
            pointModal.style.display = 'flex';
            pointAgree.checked = agreePoint.checked;
        });

        agreePointBtn.addEventListener('click', function () {
            if (pointAgree.checked) {
                agreePoint.checked = true;
                pointModal.style.display = 'none';
            } else {
                alert('請勾選同意使用須知');
            }
        });

        closePoint.addEventListener('click', function () {
            pointModal.style.display = 'none';
            pointAgree.checked = false;
        });

        // 個資燈箱控制
        const viewPrivacyNotice = document.getElementById('viewPrivacyNotice');
        const privacyModal = document.getElementById('privacyModal');
        const privacyAgree = document.getElementById('privacyAgree');
        const agreePrivacyBtn = document.getElementById('agreePrivacyBtn');
        const closePrivacy = document.getElementById('closePrivacy');

        viewPrivacyNotice.addEventListener('click', function (e) {
            e.preventDefault();
            privacyModal.style.display = 'flex';
            privacyAgree.checked = agreeCheck.checked;
        });
    </script>




</body>

</html>