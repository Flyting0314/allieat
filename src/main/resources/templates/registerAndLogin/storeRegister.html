<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-TW">

<head>

<th:block th:replace="fragments/header :: header"></th:block>
<link th:href="@{/css/storeRegister.css}" rel="stylesheet">

</head>

<body>
    <!-- Navbar Start -->
    <th:block th:replace="fragments/bodySection :: bodySection"></th:block>
    <!-- Hero Section End -->
    <!-- Registration Form Start -->
    <div class="partner_reg_wrapper">
        <div class="partner_reg_container">
            <h1 class="partner_reg_title">åˆä½œåº—å®¶è¨»å†Š</h1>
            <p class="partner_reg_subtitle">ä»¥ä¸‹æ¬„ä½çš†ç‚ºå¿…å¡«</p>
            <th:block th:with="hasSubmitted=${hasSubmitted}">
                <form th:action="@{/registerAndLogin/register/store}" th:object="${store}" method="post"
                    enctype="multipart/form-data">

                    <!-- åº—å®¶åç¨± -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">åº—å®¶åç¨±</label>
                        <div class="partner_form_controls">
                            <input type="text" th:field="*{name}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                        </div>
                    </div>

                    <!-- è² è²¬äººå§“å -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">è² è²¬äººå§“å</label>
                        <div class="partner_form_controls">
                            <input type="text" th:field="*{managerName}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('managerName')}"
                                th:errors="*{managerName}"></div>
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">Email</label>
                        <div class="partner_form_controls">
                            <input type="email" th:field="*{email}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
                        </div>
                    </div>

                    <!-- è¡Œå‹•é›»è©± -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">è¡Œå‹•é›»è©±</label>
                        <div class="partner_form_controls">
                            <input type="text" th:field="*{phoneNum}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('phoneNum')}" th:errors="*{phoneNum}">
                            </div>
                        </div>
                    </div>

                    <!-- çµ±ä¸€ç·¨è™Ÿ -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">çµ±ä¸€ç·¨è™Ÿ</label>
                        <div class="partner_form_controls">
                            <input type="text" th:field="*{guiNum}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('guiNum')}" th:errors="*{guiNum}"
                                maxlength="8"></div>
                        </div>
                    </div>

                    <!-- é£Ÿå“æ¥­è€…ç™»éŒ„å­—è™Ÿ -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">é£Ÿå“æ¥­è€…ç™»éŒ„å­—è™Ÿ</label>
                        <div class="partner_form_controls">
                            <input type="text" th:field="*{businessRegNum}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('businessRegNum')}"
                                th:errors="*{businessRegNum}"></div>
                        </div>
                    </div>

                    <!-- åœ°å€ -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">åº—å®¶åœ°å€</label>
                        <div class="partner_form_controls">
                            <!-- ç¸£å¸‚ -->
<select class="partner_select" id="citySelect" th:field="*{county}" th:attr="data-selected=${county}">
    <option value="">è«‹é¸æ“‡ç¸£å¸‚</option>
</select>

<select class="partner_select" id="districtSelect" th:field="*{district}"  th:attr="data-selected=${district}">
    <option value="">è«‹é¸æ“‡é„‰é®å¸‚å€</option>
</select>

<input type="text" id="zipcodeInput" th:field="*{postalCode}" class="partner_input" placeholder="éƒµéå€è™Ÿ">




<!--                             <div class="text-danger" th:if="${#fields.hasErrors('district')}" th:errors="*{district}"> -->
<!--                             </div> -->

                            <!-- éƒµéå€è™Ÿ -->
<!--                             <input type="text" th:field="*{postalCode}" class="partner_input" placeholder="éƒµéå€è™Ÿ" -->
<!--                                 id="zipcodeInput"> -->
<!--                             <div class="text-danger" th:if="${#fields.hasErrors('postalCode')}" -->
<!--                                 th:errors="*{postalCode}"></div> -->
<div class="text-danger" th:if="${#fields.hasErrors('county')}" th:text="'è«‹è¼¸å…¥ç¸£å¸‚ã€é„‰é®å¸‚å€ã€éƒµéå€è™Ÿ'"></div>

                            <!-- è©³ç´°åœ°å€ -->
                            <input type="text" th:field="*{address}" class="partner_input" placeholder="è©³ç´°åœ°å€">
                            <div class="text-danger" th:if="${#fields.hasErrors('address')}" th:errors="*{address}">
                            </div>
                        </div>
                    </div>

                    <!-- å¯†ç¢¼ -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">å¯†ç¢¼</label>
                        <div class="partner_form_controls">
                            <input type="password" th:field="*{password}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('password')}" th:errors="*{password}">
                            </div>
                        </div>
                    </div>

                    <!-- ç…§ç‰‡ä¸Šå‚³å€åŸŸ -->
                    <div class="partner_form_group">
                        <div class="partner_photos_section">
                            <h2 class="partner_photo_upload_title">è«‹ä¸Šå‚³ç…§ç‰‡</h2>
                            <div class="partner_photo_grid">
                                <div class="partner_photo_item">
                                    <div class="partner_photo_label">åº—å®¶å°é¢ç…§</div>

                                    <!-- é è¦½åœ–æœ‰è³‡æ–™å°±è‡ªå‹•é¡¯ç¤º -->
                                    <div class="partner_photo_preview" id="coverPhotoPreview">
                                        <img th:each="photo : ${photoList}" th:if="${photo.photoType == 'COVER'}"
                                            th:src="${photo.src}" class="preview-img" alt="å°é¢é è¦½åœ–" />
                                    </div>

                                    <!--  ä¿®æ”¹æç¤ºèªå¥ -->
                                    <input type="hidden" id="hasSubmittedFlag" th:value="${hasSubmitted}" />
                                    <p class="text-muted small cover-hint"
                                        th:if="${store.storeToPhoto != null and store.storeToPhoto.?[photoType == 'COVER'].size() > 0}">
                                        è‹¥æ‚¨ä¸æƒ³æ›´æ›åœ–ç‰‡ï¼Œç„¡éœ€é‡æ–°é¸æ“‡æª”æ¡ˆã€‚
                                    </p>
                                    <!-- ä¸Šå‚³æ¬„ä½ -->
                                    <div class="partner_photo_upload_field">
                                        <label class="custom-upload-btn">
                                            é¸æ“‡æª”æ¡ˆ
                                            <input type="file" name="photoFiles" id="file_upload_cover" accept="image/*"
                                                hidden>
                                        </label>
                                        <span id="coverFileName" class="file-name-text">é¸æ“‡æª”æ¡ˆ</span>
                                    </div>
                                </div>

                                <div class="partner_photo_item">
                                    <div class="partner_photo_label">å»šæˆ¿ç’°å¢ƒç…§</div>
                                    <div class="partner_photo_preview" id="kitchenPhotoPreview">
                                        <img th:each="photo : ${photoList}" th:if="${photo.photoType == 'KITCHEN'}"
                                            th:src="${photo.src}" class="preview-img" alt="å»šæˆ¿é è¦½åœ–" />
                                    </div>

                                    <p class="text-muted small kitchen-hint"
                                        th:if="${store.storeToPhoto != null and store.storeToPhoto.?[photoType == 'KITCHEN'].size() > 0}">
                                        è‹¥æ‚¨ä¸æƒ³æ›´æ›åœ–ç‰‡ï¼Œç„¡éœ€é‡æ–°é¸æ“‡æª”æ¡ˆã€‚
                                    </p>
                                    <div class="partner_photo_upload_field">
                                        <label class="custom-upload-btn">
                                            é¸æ“‡æª”æ¡ˆ
                                            <input type="file" name="photoFiles" id="file_upload_kitchen"
                                                accept="image/*" hidden>
                                        </label>
                                        <span id="kitchenFileName" class="file-name-text">é¸æ“‡æª”æ¡ˆ</span>
                                    </div>
                                </div>


                                <div class="partner_photo_item">
                                    <div class="partner_photo_label">åº—é¢ç’°å¢ƒç…§</div>
                                    <div class="partner_photo_preview" id="storePhotoPreview">
                                        <img th:each="photo : ${photoList}" th:if="${photo.photoType == 'STORE'}"
                                            th:src="${photo.src}" class="preview-img" alt="åº—é¢é è¦½åœ–" />
                                    </div>
                                    <p class="text-muted small store-hint"
                                        th:if="${store.storeToPhoto != null and store.storeToPhoto.?[photoType == 'STORE'].size() > 0}">
                                        è‹¥æ‚¨ä¸æƒ³æ›´æ›åœ–ç‰‡ï¼Œç„¡éœ€é‡æ–°é¸æ“‡æª”æ¡ˆã€‚
                                    </p>

                                    <div class="partner_photo_upload_field">
                                        <label class="custom-upload-btn">
                                            é¸æ“‡æª”æ¡ˆ
                                            <input type="file" name="photoFiles" id="file_upload_store" accept="image/*"
                                                hidden>
                                        </label>
                                        <span id="storeFileName" class="file-name-text">é¸æ“‡æª”æ¡ˆ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- å…¨éƒ¨ç…§ç‰‡å€çš„éŒ¯èª¤æç¤º -->
                    </div>
                    <div id="photoError" class="text-danger mt-2" th:if="${photoError} and ${hasSubmitted}"
                        th:text="${photoError}">
                    </div>
                    <!-- åŒæ„ä½¿ç”¨é ˆçŸ¥å€å¡Š -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">
                            <input type="checkbox" id="agreeCheck" name="agreeCheck" onclick="return false"
                                value="true"> æˆ‘å·²é–±è®€ä¸¦åŒæ„
                            <input type="hidden" name="agreedToTerms" id="agreedToTerms" value="false">
                            <a href="#" id="viewNotice"
                                style="color: blue; text-decoration: underline; cursor: pointer;">ä½¿ç”¨é ˆçŸ¥</a>
                        </label>
                    </div>
                    <!-- 				<div class="text-danger" th:if="${errorMessage}" th:text="${errorMessage}"></div> -->
                    <div id="errorMessage" class="text-danger" th:classappend="${errorMessage} ? '' : 'hidden'"
                        th:text="${errorMessage}"></div>


                    <div class="partner_button_container">
                        <button type="button" class="partner_back_btn"
                            th:onclick="|location.href='@{/registerAndLogin/register}'|">ä¸Šä¸€é </button>
                        <button type="submit" class="partner_next_btn" id="submitBtn">ä¸‹ä¸€æ­¥</button>
                    </div>
                </form>
            </th:block>
        </div>
    </div>

    <!-- ä½¿ç”¨é ˆçŸ¥ç‡ˆç®± Modal -->
    <div id="noticeModal" class="modal"
        style="display:none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
        <div class="modal-content"
            style="background: white; padding: 20px; border-radius: 10px; width: max-content; max-height: 80%; overflow-y: auto;">
            <h3>ä½¿ç”¨é ˆçŸ¥</h3>
            <p style="white-space: pre-wrap; font-size: 14px; line-height: 1.8;">
                <p>ä¸€ã€æ”å‘·éœ¸å¾…ç”¨é¤å¹³å°ï¼ˆä»¥ä¸‹ç°¡ç¨±å¹³å°ï¼‰å…§æ‰€ç¨±é»æ•¸ï¼ŒæŒ‡ç”±ææ¬¾äººæè´ˆæ¬¾é …è½‰æ›ç‚ºè™›æ“¬é»æ•¸ï¼Œä¸¦ç”±å¹³å°å°‡è©²é»æ•¸æ ¸ç™¼è‡³å—åŠ©è€…æœƒå“¡å¸³è™Ÿä¸­ï¼Œç”¨ä»¥å…Œæ›èˆ‡å¹³å°åˆä½œä¹‹åº—å®¶æ‰€æä¾›çš„å¾…ç”¨é¤é»ã€‚</p> 

				<p>äºŒã€ç”³è«‹åŠ å…¥å¾…ç”¨é¤åˆä½œåº—å®¶ï¼š å…·æœ‰æ”¿åºœç«‹æ¡ˆç›¸é—œç‡Ÿæ¥­ç™»è¨˜çš„æ¥­è€…ï¼Œå¾—æª¢é™„ç›¸é—œè­‰æ˜æ–‡ä»¶è‡³æœ¬å¹³å°ç¶²ç«™ç”³è«‹é é¢é€²è¡Œç”³è«‹ã€‚</p> 
				
				<p>ä¸‰ã€åº—å®¶ç›¸é—œè¦å®šï¼š</p> (ä¸€) é£Ÿå“è¡›ç”Ÿï¼šåº—å®¶ä¹‹åº—å…§ç’°å¢ƒã€äººå“¡ã€è¨­å‚™ã€é£Ÿæï¼Œçš†æ‡‰ç¬¦åˆç›¸é—œé£Ÿå“è¡›ç”Ÿä¹‹è¦å®šã€‚ <br>(äºŒ) è³‡æ–™ç•°å‹•ï¼šè² è²¬äººã€åº—åã€åœ°å€ç­‰è³‡æ–™ç•°å‹•ï¼Œè«‹æ–¼15æ—¥å…§æª¢é™„ç›¸é—œè³‡æ–™è¯ç¹«æœ¬å¹³å°ã€‚ <br>(ä¸‰) æ ¸éŠ·ç¨‹åºï¼šåº—å®¶éœ€æä¾›é ˜æ“šã€åŒ¯æ¬¾å¸³æˆ¶å½±æœ¬åŠå›æ”¶ä¹‹é¤åˆ¸äºˆæœ¬å±€ï¼Œè¾¦ç†æ ¸éŠ·äº‹å®œã€‚æ–¼æ¯æœˆ31æ—¥èµ·é€²è¡Œå‰æœˆä»½é¤åˆ¸ä¹‹æ ¸éŠ·ï¼Œæ ¸éŠ·è‡³æ’¥æ¬¾ç´„éœ€2é€±æ™‚é–“ã€‚</p> 
				
				<p>å››ã€è«‹ä¸Šå‚³çœŸå¯¦åº—å®¶è³‡æ–™ï¼Œä¸¦ç¢ºä¿è³‡è¨Šç„¡èª¤ï¼Œå¦å‰‡ç„¡æ³•é€šéå¯©æ ¸ã€‚</p>
				
				<p>äº”ã€è‹¥åº—å®¶æä¾›ä¸å¯¦è³‡è¨Šæˆ–é•åæœ¬å¹³å°è¦ç¯„ï¼Œç¶“æŸ¥è­‰å±¬å¯¦å¾Œï¼Œå¹³å°å°‡ä¿ç•™åœæ¬Šæˆ–çµ‚æ­¢åˆä½œä¹‹æ¬Šåˆ©ã€‚</p>
            </p>
            <label><input type="checkbox" id="noticeAgree"> å·²é–±è®€ä¸”åŒæ„ä¸Šè¿°é ˆçŸ¥å…§å®¹</label>


            <div style="margin-top: 20px; display: flex; justify-content: center;">
                <button id="exitNotice" style="padding: 6px 12px;">é—œé–‰</button>
            </div>
        </div>
    </div>


    <!-- Footer Start -->
    <th:block th:replace="fragments/footer :: footer"></th:block>
    <!-- Footer End -->


    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Contact Javascript File -->
    <script src="mail/jqBootstrapValidation.min.js"></script>
    <script src="mail/contact.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <!-- Custom Javascript -->



    <script th:inline="javascript">
    const addrData = JSON.parse(/*[[${@addressData.getAllJson()}]]*/ '[]');
    console.log(addrData);
    document.addEventListener('DOMContentLoaded', function () {
        const citySelect = document.getElementById('citySelect');
        const districtSelect = document.getElementById('districtSelect');
        const zipInput = document.getElementById('zipcodeInput');
        const viewNotice = document.getElementById('viewNotice');
        const noticeModal = document.getElementById('noticeModal');
        const noticeAgree = document.getElementById('noticeAgree');
        const agreeCheck = document.getElementById('agreeCheck');
        const exitNotice = document.getElementById('exitNotice');
        const agreedHiddenInput = document.getElementById("agreedToTerms");
        const errorMessage = document.getElementById("errorMessage");

        const coverHint = document.querySelector(".cover-hint");
        const kitchenHint = document.querySelector(".kitchen-hint");
        const storeHint = document.querySelector(".store-hint");

        const coverPreview = document.getElementById("coverPhotoPreview");
        const kitchenPreview = document.getElementById("kitchenPhotoPreview");
        const storePreview = document.getElementById("storePhotoPreview");

        const hasSubmitted = document.getElementById('hasSubmittedFlag')?.value === "true";

        addrData.forEach(cityObj => {
            console.log(cityObj.city); 
        });
        
        
        
        
        // ğŸš€ å„ªå…ˆè®€å– sessionStorageï¼Œç¢ºä¿è¿”å›ä¿®æ”¹æ™‚ä¿ç•™é¸å–ç‹€æ…‹
        const agreedSession = sessionStorage.getItem("noticeAgreed");
        if (agreedSession !== null) {
            agreeCheck.checked = agreedSession === "true";
            agreedHiddenInput.value = agreeCheck.checked ? "true" : "false";
        } else {
            // ğŸš€ åˆæ¬¡è¼‰å…¥æ™‚ä¸é¸å–ï¼Œé¿å…é è¨­å‹¾é¸
            agreeCheck.checked = false;
            agreedHiddenInput.value = "false";
        }
        //  é–‹å•Ÿç‡ˆç®±
        viewNotice.addEventListener('click', function (e) {
            e.preventDefault();
            noticeModal.style.display = 'flex';
            noticeAgree.checked = agreeCheck.checked;
        });

        //  é—œé–‰ç‡ˆç®±
        exitNotice.addEventListener('click', function () {
            noticeModal.style.display = 'none';

            if (noticeAgree.checked) {
                agreeCheck.checked = true;
                agreedHiddenInput.value = 'true';
                sessionStorage.setItem("noticeAgreed", "true");
                if (errorMessage) errorMessage.classList.add("hidden");
            } else {
                agreeCheck.checked = false;
                agreedHiddenInput.value = 'false';
                sessionStorage.removeItem("noticeAgreed");
                if (errorMessage) errorMessage.classList.remove("hidden");
            }
        });

        //  åŒæ­¥ç‹€æ…‹
        
		        // ä½¿ç”¨ sessionStorage ç¢ºä¿åªåœ¨ç•¶å‰æµç¨‹å…§ä¿ç•™ç‹€æ…‹
		if (sessionStorage.getItem("noticeAgreed") === "true") {
		    agreeCheck.checked = true;
		    agreedHiddenInput.value = "true";
		} else {
		    agreeCheck.checked = false;
		    agreedHiddenInput.value = "false";
		}


        //  è¨˜éŒ„è®Šæ›´
        agreeCheck.addEventListener("change", function () {
            localStorage.setItem("agreedToTerms", agreeCheck.checked);
            agreedHiddenInput.value = agreeCheck.checked ? "true" : "false";
        });

        noticeAgree.addEventListener('change', function () {
            if (!noticeAgree.checked) {
                agreeCheck.checked = false;
                agreedHiddenInput.value = 'false';
                sessionStorage.removeItem("noticeAgreed");
            } else if (errorMessage) {
                errorMessage.style.display = 'none';
            }
        });

        // åœ–ç‰‡é è¦½åŠŸèƒ½
        function previewImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            if (input && preview) {
                input.addEventListener('change', function () {
                    const file = input.files[0];
                    if (file && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            preview.innerHTML = `<img src="${e.target.result}" style="width:100%; height:100%; object-fit:cover;">`;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        preview.innerHTML = '';
                    }
                });
            }
        }

        previewImage('file_upload_cover', 'coverPhotoPreview');
        previewImage('file_upload_kitchen', 'kitchenPhotoPreview');
        previewImage('file_upload_store', 'storePhotoPreview');

        //  æª”æ¡ˆåç¨±é¡¯ç¤º
        function bindFileName(inputId, labelId) {
            const input = document.getElementById(inputId);
            const label = document.getElementById(labelId);
            input?.addEventListener('change', function () {
                label.textContent = input.files.length > 0 ? input.files[0].name : "å°šæœªé¸æ“‡æª”æ¡ˆ";
            });
        }

        bindFileName('file_upload_cover', 'coverFileName');
        bindFileName('file_upload_kitchen', 'kitchenFileName');
        bindFileName('file_upload_store', 'storeFileName');

        //  æç¤ºæ–‡å­—åˆ¤æ–·
        function checkHintAndPreview(preview, hint) {
            if (!preview?.innerHTML.trim()) {
                hint && (hint.style.display = 'none');
            }
        }

        if (!hasSubmitted) {
            checkHintAndPreview(coverPreview, coverHint);
            checkHintAndPreview(kitchenPreview, kitchenHint);
            checkHintAndPreview(storePreview, storeHint);
         // ğŸ§¼ å¦‚æœ file input æ²’æœ‰å€¼ï¼Œå°±ä¸è¦é¡¯ç¤ºåœ–ç‰‡é è¦½
            function hidePreviewIfNoFile(inputId, previewId, hintClass, labelId) {
                const input = document.getElementById(inputId);
                const preview = document.getElementById(previewId);
                const hint = document.querySelector(hintClass);
                const fileLabel = document.getElementById(labelId);
                if (input && preview && input.files.length === 0) {
                    preview.innerHTML = "";
                    hint && (hint.style.display = "none");
                    fileLabel && (fileLabel.textContent = "å°šæœªé¸æ“‡æª”æ¡ˆ");
                }
            }

            // ğŸ§¼ æ¸…é™¤é è¦½åœ–èˆ‡éŒ¯èª¤æç¤ºæ–‡å­—ï¼ˆåƒ…ç•¶è¿”å›ä¿®æ”¹ä½†æ²’é‡æ–°ä¸Šå‚³æ™‚ï¼‰
            if (!hasSubmitted) {
                hidePreviewIfNoFile("file_upload_cover", "coverPhotoPreview", ".cover-hint", "coverFileName");
                hidePreviewIfNoFile("file_upload_kitchen", "kitchenPhotoPreview", ".kitchen-hint", "kitchenFileName");
                hidePreviewIfNoFile("file_upload_store", "storePhotoPreview", ".store-hint", "storeFileName");
            }

        }
        
     // è‡ªå‹•éš±è—éŒ¯èª¤æç¤º=====
        document.querySelectorAll('.partner_input, .partner_select').forEach(function (field) {
            field.addEventListener('input', handleFieldChange);
            field.addEventListener('change', handleFieldChange);
        });

        function handleFieldChange(e) {
            // æ‰¾åˆ°ä¸‹æ–¹æœ€è¿‘çš„ .text-danger é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯çš„å…ƒç´ 
            const parent = e.target.closest('.partner_form_controls');
            if (!parent) return;

            const errorDiv = parent.querySelector('.text-danger');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
        }
        
        
        document.querySelector("input[name='address']")?.addEventListener('input', function () {
            const error = this.nextElementSibling;
            if (error?.classList.contains('text-danger')) {
                error.style.display = 'none';
            }
        });

        // é‡å°ç¸£å¸‚é¸æ“‡æ™‚æ¸…é™¤æ•´åˆéŒ¯èª¤
        document.getElementById("citySelect")?.addEventListener('change', function () {
            const countyError = this.closest('.partner_form_controls')?.querySelector('.text-danger');
            if (countyError) {
                countyError.style.display = 'none';
            }
        });
        

        function clearPhotoErrorOnSelect(inputId) {
            const input = document.getElementById(inputId);
            const photoError = document.getElementById('photoError');
            if (input && photoError) {
                input.addEventListener('change', function () {
                    if (input.files.length > 0) {
                        photoError.style.display = 'none';
                        photoError.classList.add("hidden");
                    }
                });
            }
        }
        clearPhotoErrorOnSelect('file_upload_cover');
        clearPhotoErrorOnSelect('file_upload_kitchen');
        clearPhotoErrorOnSelect('file_upload_store');
     // âœ… è‹¥å·²æœ‰é è¦½åœ–ï¼Œå‰‡è£œä¸Šæª”åæç¤º
        if (document.querySelector('#coverPhotoPreview img')) {
            document.getElementById('coverFileName').textContent = 'å·²ä¸Šå‚³åœ–ç‰‡';
        }
        if (document.querySelector('#kitchenPhotoPreview img')) {
            document.getElementById('kitchenFileName').textContent = 'å·²ä¸Šå‚³åœ–ç‰‡';
        }
        if (document.querySelector('#storePhotoPreview img')) {
            document.getElementById('storeFileName').textContent = 'å·²ä¸Šå‚³åœ–ç‰‡';
        }

        
   
 // ===== é‚„åŸ =====
//     function clearPhotoErrorOnSelect(inputId) {
//         const input = document.getElementById(inputId);
//         const photoError = document.getElementById('photoError');
//         if (input && photoError) {
//             input.addEventListener('change', function () {
//                 if (input.files.length > 0) {
//                     photoError.style.display = 'none';
//                     photoError.classList.add("hidden");
//                 }
//             });
//         }
//     }
//     clearPhotoErrorOnSelect('file_upload_cover');
//     clearPhotoErrorOnSelect('file_upload_kitchen');
//     clearPhotoErrorOnSelect('file_upload_store');
    
 


//====
    exitNotice.addEventListener('click', function () {
        noticeModal.style.display = 'none';

        if (noticeAgree.checked) {
            agreeCheck.checked = true;
            agreedHiddenInput.value = 'true';
            localStorage.setItem("agreedToTerms", "true"); // âœ… å­˜å…¥ localStorage
            sessionStorage.setItem("noticeAgreed", "true");
            if (errorMessage) errorMessage.classList.add("hidden");
        } else {
            agreeCheck.checked = false;
            agreedHiddenInput.value = 'false';
            localStorage.removeItem("agreedToTerms"); // âœ… ç§»é™¤è¨˜æ†¶
            sessionStorage.removeItem("noticeAgreed");
            if (errorMessage) errorMessage.classList.remove("hidden");
        }
    });
        
 //===       
        
        console.log("City Select:", citySelect);
        console.log("District Select:", districtSelect);
        console.log("Zipcode Input:", zipInput);
        
        if (citySelect && districtSelect && zipInput) {
            const selectedDistrict = districtSelect.value || "";
            const selectedCity = initCitySelect(); // ğŸš€ ç”±å‡½å¼å…§è‡ªè¡Œå–å¾—åˆå§‹å€¼

            if (selectedCity) {
                updateDistricts(selectedCity, selectedDistrict);
            }
            
            // ğŸš€ ç•¶ã€Œç¸£å¸‚ã€è®Šæ›´æ™‚ï¼Œè¨˜ä½é¸æ“‡
            citySelect.addEventListener("change", function () {
                sessionStorage.setItem("selectedCity", this.value);
                sessionStorage.removeItem("selectedDistrict"); // ğŸš€ æ¸…é™¤èˆŠé„‰é®å¸‚å€
                updateDistricts(this.value, "");
            });

            // ğŸš€ ç•¶ã€Œé„‰é®å¸‚å€ã€è®Šæ›´æ™‚ï¼Œè¨˜ä½é¸æ“‡
            districtSelect.addEventListener("change", function () {
                sessionStorage.setItem("selectedDistrict", this.value);
                updateZipcode(citySelect.value, this.value);
            });
        }



        
        // åˆå§‹åŒ–ç¸£å¸‚é¸å–®
		function initCitySelect() {
		    const selectedCity = citySelect.value || ""; // âœ… ç”¨ .value è€Œé getAttribute
		    citySelect.innerHTML = '<option value="">è«‹é¸æ“‡ç¸£å¸‚</option>';
		
		    addrData.forEach(item => {
		        const option = document.createElement("option");
		        option.value = item.city;
		        option.textContent = item.city;
		        citySelect.appendChild(option);
		    });
		
		    if (selectedCity) {
		        citySelect.value = selectedCity; // âœ… é¸å›æ­£ç¢ºçš„é …ç›®
		    }
		
		    return selectedCity;
		}

		        
        // æ›´æ–°é„‰é®å¸‚å€é¸å–®
        function updateDistricts(city, selectedDistrict) {
    const cityObj = addrData.find(item => item.city === city);
    districtSelect.innerHTML = '<option value="">è«‹é¸æ“‡é„‰é®å¸‚å€</option>';

    if (cityObj) {
        cityObj.area.forEach(area => {
            const option = document.createElement("option");
            option.value = area.name;
            option.textContent = area.name;
            districtSelect.appendChild(option);
        });

        // ğŸš€ é—œéµï¼šæ‰€æœ‰é¸é …æ¸²æŸ“å®Œå¾Œå†è¨­å®šé¸å–å€¼
        setTimeout(() => {
            districtSelect.value = selectedDistrict;
        }, 50);
    }
}
        
        // æ›´æ–°éƒµéå€è™Ÿ
        function updateZipcode(city, district) {
            const cityObj = addrData.find(item => item.city === city);
            if (cityObj) {
                const areaObj = cityObj.area.find(area => area.name === district);
                zipInput.value = areaObj ? areaObj.zipcode : "";
            }
        }
    });
//======domçµæŸ=====




            </script>

</body>
</html>
