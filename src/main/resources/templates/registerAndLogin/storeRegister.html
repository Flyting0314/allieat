<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-TW">

<head>

<th:block th:replace="fragments/header :: header"></th:block>
<link th:href="@{/css/storeRegister.css}" rel="stylesheet">

</head>

<body>
    <!-- Navbar Start -->
    <th:block th:replace="fragments/bodySection :: bodySection"></th:block>
    <!-- Hero Section End -->
    <!-- Registration Form Start -->
    <div class="partner_reg_wrapper">
        <div class="partner_reg_container">
            <h1 class="partner_reg_title">合作店家註冊</h1>
            <p class="partner_reg_subtitle">以下欄位皆為必填</p>
            <th:block th:with="hasSubmitted=${hasSubmitted}">
                <form th:action="@{/registerAndLogin/register/store}" th:object="${store}" method="post"
                    enctype="multipart/form-data">

                    <!-- 店家名稱 -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">店家名稱</label>
                        <div class="partner_form_controls">
                            <input type="text" th:field="*{name}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                        </div>
                    </div>

                    <!-- 負責人姓名 -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">負責人姓名</label>
                        <div class="partner_form_controls">
                            <input type="text" th:field="*{managerName}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('managerName')}"
                                th:errors="*{managerName}"></div>
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">Email</label>
                        <div class="partner_form_controls">
                            <input type="email" th:field="*{email}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
                        </div>
                    </div>

                    <!-- 行動電話 -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">行動電話</label>
                        <div class="partner_form_controls">
                            <input type="text" th:field="*{phoneNum}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('phoneNum')}" th:errors="*{phoneNum}">
                            </div>
                        </div>
                    </div>

                    <!-- 統一編號 -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">統一編號</label>
                        <div class="partner_form_controls">
                            <input type="text" th:field="*{guiNum}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('guiNum')}" th:errors="*{guiNum}"
                                maxlength="8"></div>
                        </div>
                    </div>

                    <!-- 食品業者登錄字號 -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">食品業者登錄字號</label>
                        <div class="partner_form_controls">
                            <input type="text" th:field="*{businessRegNum}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('businessRegNum')}"
                                th:errors="*{businessRegNum}"></div>
                        </div>
                    </div>

                    <!-- 地址 -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">店家地址</label>
                        <div class="partner_form_controls">
                            <!-- 縣市 -->
<select class="partner_select" id="citySelect" th:field="*{county}">
    <option value="">請選擇縣市</option>
</select>

<select class="partner_select" id="districtSelect" th:field="*{district}">
    <option value="">請選擇鄉鎮市區</option>
</select>

<input type="text" id="zipcodeInput" th:field="*{postalCode}" class="partner_input" placeholder="郵遞區號">




<!--                             <div class="text-danger" th:if="${#fields.hasErrors('district')}" th:errors="*{district}"> -->
<!--                             </div> -->

                            <!-- 郵遞區號 -->
<!--                             <input type="text" th:field="*{postalCode}" class="partner_input" placeholder="郵遞區號" -->
<!--                                 id="zipcodeInput"> -->
<!--                             <div class="text-danger" th:if="${#fields.hasErrors('postalCode')}" -->
<!--                                 th:errors="*{postalCode}"></div> -->
<div class="text-danger" th:if="${#fields.hasErrors('county')}" th:text="'請輸入縣市、鄉鎮市區、郵遞區號'"></div>

                            <!-- 詳細地址 -->
                            <input type="text" th:field="*{address}" class="partner_input" placeholder="詳細地址">
                            <div class="text-danger" th:if="${#fields.hasErrors('address')}" th:errors="*{address}">
                            </div>
                        </div>
                    </div>

                    <!-- 密碼 -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">密碼</label>
                        <div class="partner_form_controls">
                            <input type="password" th:field="*{password}" class="partner_input">
                            <div class="text-danger" th:if="${#fields.hasErrors('password')}" th:errors="*{password}">
                            </div>
                        </div>
                    </div>

                    <!-- 照片上傳區域 -->
                    <div class="partner_form_group">
                        <div class="partner_photos_section">
                            <h2 class="partner_photo_upload_title">請上傳照片</h2>
                            <div class="partner_photo_grid">
                                <div class="partner_photo_item">
                                    <div class="partner_photo_label">店家封面照</div>

                                    <!-- 預覽圖有資料就自動顯示 -->
                                    <div class="partner_photo_preview" id="coverPhotoPreview">
                                        <img th:each="photo : ${photoList}" th:if="${photo.photoType == 'COVER'}"
                                            th:src="${photo.src}" class="preview-img" alt="封面預覽圖" />
                                    </div>

                                    <!--  修改提示語句 -->
                                    <input type="hidden" id="hasSubmittedFlag" th:value="${hasSubmitted}" />
                                    <p class="text-muted small cover-hint"
                                        th:if="${store.storeToPhoto != null and store.storeToPhoto.?[photoType == 'COVER'].size() > 0}">
                                        若您不想更換圖片，無需重新選擇檔案。
                                    </p>
                                    <!-- 上傳欄位 -->
                                    <div class="partner_photo_upload_field">
                                        <label class="custom-upload-btn">
                                            選擇檔案
                                            <input type="file" name="photoFiles" id="file_upload_cover" accept="image/*"
                                                hidden>
                                        </label>
                                        <span id="coverFileName" class="file-name-text">選擇檔案</span>
                                    </div>
                                </div>

                                <div class="partner_photo_item">
                                    <div class="partner_photo_label">廚房環境照</div>
                                    <div class="partner_photo_preview" id="kitchenPhotoPreview">
                                        <img th:each="photo : ${photoList}" th:if="${photo.photoType == 'KITCHEN'}"
                                            th:src="${photo.src}" class="preview-img" alt="廚房預覽圖" />
                                    </div>

                                    <p class="text-muted small kitchen-hint"
                                        th:if="${store.storeToPhoto != null and store.storeToPhoto.?[photoType == 'KITCHEN'].size() > 0}">
                                        若您不想更換圖片，無需重新選擇檔案。
                                    </p>
                                    <div class="partner_photo_upload_field">
                                        <label class="custom-upload-btn">
                                            選擇檔案
                                            <input type="file" name="photoFiles" id="file_upload_kitchen"
                                                accept="image/*" hidden>
                                        </label>
                                        <span id="kitchenFileName" class="file-name-text">選擇檔案</span>
                                    </div>
                                </div>


                                <div class="partner_photo_item">
                                    <div class="partner_photo_label">店面環境照</div>
                                    <div class="partner_photo_preview" id="storePhotoPreview">
                                        <img th:each="photo : ${photoList}" th:if="${photo.photoType == 'STORE'}"
                                            th:src="${photo.src}" class="preview-img" alt="店面預覽圖" />
                                    </div>
                                    <p class="text-muted small store-hint"
                                        th:if="${store.storeToPhoto != null and store.storeToPhoto.?[photoType == 'STORE'].size() > 0}">
                                        若您不想更換圖片，無需重新選擇檔案。
                                    </p>

                                    <div class="partner_photo_upload_field">
                                        <label class="custom-upload-btn">
                                            選擇檔案
                                            <input type="file" name="photoFiles" id="file_upload_store" accept="image/*"
                                                hidden>
                                        </label>
                                        <span id="storeFileName" class="file-name-text">選擇檔案</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 全部照片區的錯誤提示 -->
                    </div>
                    <div id="photoError" class="text-danger mt-2" th:if="${photoError} and ${hasSubmitted}"
                        th:text="${photoError}">
                    </div>
                    <!-- 同意使用須知區塊 -->
                    <div class="partner_form_group">
                        <label class="partner_form_label">
                            <input type="checkbox" id="agreeCheck" name="agreeCheck" onclick="return false"
                                value="true"> 我已閱讀並同意
                            <input type="hidden" name="agreedToTerms" id="agreedToTerms" value="false">
                            <a href="#" id="viewNotice"
                                style="color: blue; text-decoration: underline; cursor: pointer;">使用須知</a>
                        </label>
                    </div>
                    <!-- 				<div class="text-danger" th:if="${errorMessage}" th:text="${errorMessage}"></div> -->
                    <div id="errorMessage" class="text-danger" th:classappend="${errorMessage} ? '' : 'hidden'"
                        th:text="${errorMessage}"></div>


                    <div class="partner_button_container">
                        <button type="button" class="partner_back_btn"
                            th:onclick="|location.href='@{/registerAndLogin/register}'|">上一頁</button>
                        <button type="submit" class="partner_next_btn" id="submitBtn">下一步</button>
                    </div>
                </form>
            </th:block>
        </div>
    </div>

    <!-- 使用須知燈箱 Modal -->
    <div id="noticeModal" class="modal"
        style="display:none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
        <div class="modal-content"
            style="background: white; padding: 20px; border-radius: 10px; width: max-content; max-height: 80%; overflow-y: auto;">
            <h3>使用須知</h3>
            <p style="white-space: pre-wrap; font-size: 14px; line-height: 1.8;">
                <p>一、攏呷霸待用餐平台（以下簡稱平台）內所稱點數，指由捐款人捐贈款項轉換為虛擬點數，並由平台將該點數核發至受助者會員帳號中，用以兌換與平台合作之店家所提供的待用餐點。</p> 

				<p>二、申請加入待用餐合作店家： 具有政府立案相關營業登記的業者，得檢附相關證明文件至本平台網站申請頁面進行申請。</p> 
				
				<p>三、店家相關規定：</p> (一) 食品衛生：店家之店內環境、人員、設備、食材，皆應符合相關食品衛生之規定。 <br>(二) 資料異動：負責人、店名、地址等資料異動，請於15日內檢附相關資料聯繫本平台。 <br>(三) 核銷程序：店家需提供領據、匯款帳戶影本及回收之餐券予本局，辦理核銷事宜。於每月31日起進行前月份餐券之核銷，核銷至撥款約需2週時間。</p> 
				
				<p>四、請上傳真實店家資料，並確保資訊無誤，否則無法通過審核。</p>
				
				<p>五、若店家提供不實資訊或違反本平台規範，經查證屬實後，平台將保留停權或終止合作之權利。</p>
            </p>
            <label><input type="checkbox" id="noticeAgree"> 已閱讀且同意上述須知內容</label>


            <div style="margin-top: 20px; display: flex; justify-content: center;">
                <button id="exitNotice" style="padding: 6px 12px;">關閉</button>
            </div>
        </div>
    </div>


    <!-- Footer Start -->
    <th:block th:replace="fragments/footer :: footer"></th:block>
    <!-- Footer End -->


    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Contact Javascript File -->
    <script src="mail/jqBootstrapValidation.min.js"></script>
    <script src="mail/contact.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <!-- Custom Javascript -->



    <script>
    
    document.addEventListener('DOMContentLoaded', function () {
        const viewNotice = document.getElementById('viewNotice');
        const noticeModal = document.getElementById('noticeModal');
        const noticeAgree = document.getElementById('noticeAgree');
        const agreeCheck = document.getElementById('agreeCheck');
        const exitNotice = document.getElementById('exitNotice');
        const agreedHiddenInput = document.getElementById("agreedToTerms");
        const errorMessage = document.getElementById("errorMessage");

        const coverHint = document.querySelector(".cover-hint");
        const kitchenHint = document.querySelector(".kitchen-hint");
        const storeHint = document.querySelector(".store-hint");

        const coverPreview = document.getElementById("coverPhotoPreview");
        const kitchenPreview = document.getElementById("kitchenPhotoPreview");
        const storePreview = document.getElementById("storePhotoPreview");

        const hasSubmitted = document.getElementById('hasSubmittedFlag')?.value === "true";

        
        // 縣市、區域、郵遞區號對應資料
        const addrData = [
        {
                "city": "臺北市",
                "area": [
                    { "name": "中正區", "zipcode": "100" },
                    { "name": "大同區", "zipcode": "103" },
                    { "name": "中山區", "zipcode": "104" },
                    { "name": "松山區", "zipcode": "105" },
                    { "name": "大安區", "zipcode": "106" },
                    { "name": "萬華區", "zipcode": "108" },
                    { "name": "信義區", "zipcode": "110" },
                    { "name": "士林區", "zipcode": "111" },
                    { "name": "北投區", "zipcode": "112" },
                    { "name": "內湖區", "zipcode": "114" },
                    { "name": "南港區", "zipcode": "115" },
                    { "name": "文山區", "zipcode": "116" }
                ]
            },
            {
                "city": "基隆市",
                "area": [
                    { "name": "仁愛區", "zipcode": "200" },
                    { "name": "信義區", "zipcode": "201" },
                    { "name": "中正區", "zipcode": "202" },
                    { "name": "中山區", "zipcode": "203" },
                    { "name": "安樂區", "zipcode": "204" },
                    { "name": "暖暖區", "zipcode": "205" },
                    { "name": "七堵區", "zipcode": "206" }
                ]
            },
            {
                "city": "新北市",
                "area": [
                    { "name": "萬里區", "zipcode": "207" },
                    { "name": "金山區", "zipcode": "208" },
                    { "name": "板橋區", "zipcode": "220" },
                    { "name": "汐止區", "zipcode": "221" },
                    { "name": "深坑區", "zipcode": "222" },
                    { "name": "石碇區", "zipcode": "223" },
                    { "name": "瑞芳區", "zipcode": "224" },
                    { "name": "平溪區", "zipcode": "226" },
                    { "name": "雙溪區", "zipcode": "227" },
                    { "name": "貢寮區", "zipcode": "228" },
                    { "name": "新店區", "zipcode": "231" },
                    { "name": "坪林區", "zipcode": "232" },
                    { "name": "烏來區", "zipcode": "233" },
                    { "name": "永和區", "zipcode": "234" },
                    { "name": "中和區", "zipcode": "235" },
                    { "name": "土城區", "zipcode": "236" },
                    { "name": "三峽區", "zipcode": "237" },
                    { "name": "樹林區", "zipcode": "238" },
                    { "name": "鶯歌區", "zipcode": "239" },
                    { "name": "三重區", "zipcode": "241" },
                    { "name": "新莊區", "zipcode": "242" },
                    { "name": "泰山區", "zipcode": "243" },
                    { "name": "林口區", "zipcode": "244" },
                    { "name": "蘆洲區", "zipcode": "247" },
                    { "name": "五股區", "zipcode": "248" },
                    { "name": "八里區", "zipcode": "249" },
                    { "name": "淡水區", "zipcode": "251" },
                    { "name": "三芝區", "zipcode": "252" },
                    { "name": "石門區", "zipcode": "253" }
                ]
            },
            {
                "city": "宜蘭縣",
                "area": [
                    { "name": "宜蘭", "zipcode": "260" },
                    { "name": "頭城", "zipcode": "261" },
                    { "name": "礁溪", "zipcode": "262" },
                    { "name": "壯圍", "zipcode": "263" },
                    { "name": "員山", "zipcode": "264" },
                    { "name": "羅東", "zipcode": "265" },
                    { "name": "三星", "zipcode": "266" },
                    { "name": "大同", "zipcode": "267" },
                    { "name": "五結", "zipcode": "268" },
                    { "name": "冬山", "zipcode": "269" },
                    { "name": "蘇澳", "zipcode": "270" },
                    { "name": "南澳", "zipcode": "272" },
                    { "name": "釣魚臺列嶼", "zipcode": "290" }
                ]
            },
            {
                "city": "新竹市",
                "area": [
                    { "name": "", "zipcode": "300" }
                ]
            },
            {
                "city": "新竹縣",
                "area": [
                    { "name": "竹北", "zipcode": "302" },
                    { "name": "湖口", "zipcode": "303" },
                    { "name": "新豐", "zipcode": "304" },
                    { "name": "新埔", "zipcode": "305" },
                    { "name": "關西", "zipcode": "306" },
                    { "name": "芎林", "zipcode": "307" },
                    { "name": "寶山", "zipcode": "308" },
                    { "name": "竹東", "zipcode": "310" },
                    { "name": "五峰", "zipcode": "311" },
                    { "name": "橫山", "zipcode": "312" },
                    { "name": "尖石", "zipcode": "313" },
                    { "name": "北埔", "zipcode": "314" },
                    { "name": "峨眉", "zipcode": "315" }
                ]
            },
            {
                "city": "桃園市",
                "area": [
                    { "name": "中壢區", "zipcode": "320" },
                    { "name": "平鎮區", "zipcode": "324" },
                    { "name": "龍潭區", "zipcode": "325" },
                    { "name": "楊梅區", "zipcode": "326" },
                    { "name": "新屋區", "zipcode": "327" },
                    { "name": "觀音區", "zipcode": "328" },
                    { "name": "桃園區", "zipcode": "330" },
                    { "name": "龜山區", "zipcode": "333" },
                    { "name": "八德區", "zipcode": "334" },
                    { "name": "大溪區", "zipcode": "335" },
                    { "name": "復興區", "zipcode": "336" },
                    { "name": "大園區", "zipcode": "337" },
                    { "name": "蘆竹區", "zipcode": "338" }
                ]
            },
            {
                "city": "苗栗縣",
                "area": [
                    { "name": "竹南", "zipcode": "350" },
                    { "name": "頭份", "zipcode": "351" },
                    { "name": "三灣", "zipcode": "352" },
                    { "name": "南庄", "zipcode": "353" },
                    { "name": "獅潭", "zipcode": "354" },
                    { "name": "後龍", "zipcode": "356" },
                    { "name": "通霄", "zipcode": "357" },
                    { "name": "苑裡", "zipcode": "358" },
                    { "name": "苗栗", "zipcode": "360" },
                    { "name": "造橋", "zipcode": "361" },
                    { "name": "頭屋", "zipcode": "362" },
                    { "name": "公館", "zipcode": "363" },
                    { "name": "大湖", "zipcode": "364" },
                    { "name": "泰安", "zipcode": "365" },
                    { "name": "銅鑼", "zipcode": "366" },
                    { "name": "三義", "zipcode": "367" },
                    { "name": "西湖", "zipcode": "368" },
                    { "name": "卓蘭", "zipcode": "369" }
                ]
            },
            {
                "city": "臺中市",
                "area": [
                    { "name": "中區", "zipcode": "400" },
                    { "name": "東區", "zipcode": "401" },
                    { "name": "南區", "zipcode": "402" },
                    { "name": "西區", "zipcode": "403" },
                    { "name": "北區", "zipcode": "404" },
                    { "name": "北屯區", "zipcode": "406" },
                    { "name": "西屯區", "zipcode": "407" },
                    { "name": "南屯區", "zipcode": "408" },
                    { "name": "太平區", "zipcode": "411" },
                    { "name": "大里區", "zipcode": "412" },
                    { "name": "霧峰區", "zipcode": "413" },
                    { "name": "烏日區", "zipcode": "414" },
                    { "name": "豐原區", "zipcode": "420" },
                    { "name": "后里區", "zipcode": "421" },
                    { "name": "石岡區", "zipcode": "422" },
                    { "name": "東勢區", "zipcode": "423" },
                    { "name": "和平區", "zipcode": "424" },
                    { "name": "新社區", "zipcode": "426" },
                    { "name": "潭子區", "zipcode": "427" },
                    { "name": "大雅區", "zipcode": "428" },
                    { "name": "神岡區", "zipcode": "429" },
                    { "name": "大肚區", "zipcode": "432" },
                    { "name": "沙鹿區", "zipcode": "433" },
                    { "name": "龍井區", "zipcode": "434" },
                    { "name": "梧棲區", "zipcode": "435" },
                    { "name": "清水區", "zipcode": "436" },
                    { "name": "大甲區", "zipcode": "437" },
                    { "name": "外埔區", "zipcode": "438" },
                    { "name": "大安區", "zipcode": "439" }
                ]
            },
            {
                "city": "彰化縣",
                "area": [
                    { "name": "彰化", "zipcode": "500" },
                    { "name": "芬園", "zipcode": "502" },
                    { "name": "花壇", "zipcode": "503" },
                    { "name": "秀水", "zipcode": "504" },
                    { "name": "鹿港", "zipcode": "505" },
                    { "name": "福興", "zipcode": "506" },
                    { "name": "線西", "zipcode": "507" },
                    { "name": "和美", "zipcode": "508" },
                    { "name": "伸港", "zipcode": "509" },
                    { "name": "員林", "zipcode": "510" },
                    { "name": "社頭", "zipcode": "511" },
                    { "name": "永靖", "zipcode": "512" },
                    { "name": "埔心", "zipcode": "513" },
                    { "name": "溪湖", "zipcode": "514" },
                    { "name": "大村", "zipcode": "515" },
                    { "name": "埔鹽", "zipcode": "516" },
                    { "name": "田中", "zipcode": "520" },
                    { "name": "北斗", "zipcode": "521" },
                    { "name": "田尾", "zipcode": "522" },
                    { "name": "埤頭", "zipcode": "523" },
                    { "name": "溪州", "zipcode": "524" },
                    { "name": "竹塘", "zipcode": "525" },
                    { "name": "二林", "zipcode": "526" },
                    { "name": "大城", "zipcode": "527" },
                    { "name": "芳苑", "zipcode": "528" },
                    { "name": "二水", "zipcode": "530" }
                ]
            },
            {
                "city": "南投縣",
                "area": [
                    { "name": "南投", "zipcode": "540" },
                    { "name": "中寮", "zipcode": "541" },
                    { "name": "草屯", "zipcode": "542" },
                    { "name": "國姓", "zipcode": "544" },
                    { "name": "埔里", "zipcode": "545" },
                    { "name": "仁愛", "zipcode": "546" },
                    { "name": "名間", "zipcode": "551" },
                    { "name": "集集", "zipcode": "552" },
                    { "name": "水里", "zipcode": "553" },
                    { "name": "魚池", "zipcode": "555" },
                    { "name": "信義", "zipcode": "556" },
                    { "name": "竹山", "zipcode": "557" },
                    { "name": "鹿谷", "zipcode": "558" }
                ]
            },
            {
                "city": "嘉義市",
                "area": [
                    { "name": "", "zipcode": "600" }
                ]
            },
            {
                "city": "嘉義縣",
                "area": [
                    { "name": "番路", "zipcode": "602" },
                    { "name": "梅山", "zipcode": "603" },
                    { "name": "竹崎", "zipcode": "604" },
                    { "name": "阿里山", "zipcode": "605" },
                    { "name": "中埔", "zipcode": "606" },
                    { "name": "大埔", "zipcode": "607" },
                    { "name": "水上", "zipcode": "608" },
                    { "name": "鹿草", "zipcode": "611" },
                    { "name": "太保", "zipcode": "612" },
                    { "name": "朴子", "zipcode": "613" },
                    { "name": "東石", "zipcode": "614" },
                    { "name": "六腳", "zipcode": "615" },
                    { "name": "新港", "zipcode": "616" },
                    { "name": "民雄", "zipcode": "621" },
                    { "name": "大林", "zipcode": "622" },
                    { "name": "溪口", "zipcode": "623" },
                    { "name": "義竹", "zipcode": "624" },
                    { "name": "布袋", "zipcode": "625" }
                ]
            },
            {
                "city": "雲林縣",
                "area": [
                    { "name": "斗南", "zipcode": "630" },
                    { "name": "大埤", "zipcode": "631" },
                    { "name": "虎尾", "zipcode": "632" },
                    { "name": "土庫", "zipcode": "633" },
                    { "name": "褒忠", "zipcode": "634" },
                    { "name": "東勢", "zipcode": "635" },
                    { "name": "臺西", "zipcode": "636" },
                    { "name": "崙背", "zipcode": "637" },
                    { "name": "麥寮", "zipcode": "638" },
                    { "name": "斗六", "zipcode": "640" },
                    { "name": "林內", "zipcode": "643" },
                    { "name": "古坑", "zipcode": "646" },
                    { "name": "莿桐", "zipcode": "647" },
                    { "name": "西螺", "zipcode": "648" },
                    { "name": "二崙", "zipcode": "649" },
                    { "name": "北港", "zipcode": "651" },
                    { "name": "水林", "zipcode": "652" },
                    { "name": "口湖", "zipcode": "653" },
                    { "name": "四湖", "zipcode": "654" },
                    { "name": "元長", "zipcode": "655" }
                ]
            },
            {
                "city": "臺南市",
                "area": [
                    { "name": "中西區", "zipcode": "700" },
                    { "name": "東區", "zipcode": "701" },
                    { "name": "南區", "zipcode": "702" },
                    { "name": "北區", "zipcode": "704" },
                    { "name": "安平區", "zipcode": "708" },
                    { "name": "安南區", "zipcode": "709" },
                    { "name": "永康區", "zipcode": "710" },
                    { "name": "歸仁區", "zipcode": "711" },
                    { "name": "新化區", "zipcode": "712" },
                    { "name": "左鎮區", "zipcode": "713" },
                    { "name": "玉井區", "zipcode": "714" },
                    { "name": "楠西區", "zipcode": "715" },
                    { "name": "南化區", "zipcode": "716" },
                    { "name": "仁德區", "zipcode": "717" },
                    { "name": "關廟區", "zipcode": "718" },
                    { "name": "龍崎區", "zipcode": "719" },
                    { "name": "官田區", "zipcode": "720" },
                    { "name": "麻豆區", "zipcode": "721" },
                    { "name": "佳里區", "zipcode": "722" },
                    { "name": "西港區", "zipcode": "723" },
                    { "name": "七股區", "zipcode": "724" },
                    { "name": "將軍區", "zipcode": "725" },
                    { "name": "學甲區", "zipcode": "726" },
                    { "name": "北門區", "zipcode": "727" },
                    { "name": "新營區", "zipcode": "730" },
                    { "name": "後壁區", "zipcode": "731" },
                    { "name": "白河區", "zipcode": "732" },
                    { "name": "東山區", "zipcode": "733" },
                    { "name": "六甲區", "zipcode": "734" },
                    { "name": "下營區", "zipcode": "735" },
                    { "name": "柳營區", "zipcode": "736" },
                    { "name": "鹽水區", "zipcode": "737" },
                    { "name": "善化區", "zipcode": "741" },
                    { "name": "大內區", "zipcode": "742" },
                    { "name": "山上區", "zipcode": "743" },
                    { "name": "新市區", "zipcode": "744" },
                    { "name": "安定區", "zipcode": "745" }
                ]
            },
            {
                "city": "高雄市",
                "area": [
                    { "name": "新興區", "zipcode": "800" },
                    { "name": "前金區", "zipcode": "801" },
                    { "name": "苓雅區", "zipcode": "802" },
                    { "name": "鹽埕區", "zipcode": "803" },
                    { "name": "鼓山區", "zipcode": "804" },
                    { "name": "旗津區", "zipcode": "805" },
                    { "name": "前鎮區", "zipcode": "806" },
                    { "name": "三民區", "zipcode": "807" },
                    { "name": "楠梓區", "zipcode": "811" },
                    { "name": "小港區", "zipcode": "812" },
                    { "name": "左營區", "zipcode": "813" },
                    { "name": "仁武區", "zipcode": "814" },
                    { "name": "大社區", "zipcode": "815" },
                    { "name": "岡山區", "zipcode": "820" },
                    { "name": "路竹區", "zipcode": "821" },
                    { "name": "阿蓮區", "zipcode": "822" },
                    { "name": "田寮區", "zipcode": "823" },
                    { "name": "燕巢區", "zipcode": "824" },
                    { "name": "橋頭區", "zipcode": "825" },
                    { "name": "梓官區", "zipcode": "826" },
                    { "name": "彌陀區", "zipcode": "827" },
                    { "name": "永安區", "zipcode": "828" },
                    { "name": "湖內區", "zipcode": "829" },
                    { "name": "鳳山區", "zipcode": "830" },
                    { "name": "大寮區", "zipcode": "831" },
                    { "name": "林園區", "zipcode": "832" },
                    { "name": "鳥松區", "zipcode": "833" },
                    { "name": "大樹區", "zipcode": "840" },
                    { "name": "旗山區", "zipcode": "842" },
                    { "name": "美濃區", "zipcode": "843" },
                    { "name": "六龜區", "zipcode": "844" },
                    { "name": "內門區", "zipcode": "845" },
                    { "name": "杉林區", "zipcode": "846" },
                    { "name": "甲仙區", "zipcode": "847" },
                    { "name": "桃源區", "zipcode": "848" },
                    { "name": "那瑪夏區", "zipcode": "849" },
                    { "name": "茂林區", "zipcode": "851" },
                    { "name": "茄萣區", "zipcode": "852" }
                ]
            },
            {
                "city": "南海諸島",
                "area": [
                    { "name": "東沙", "zipcode": "817" },
                    { "name": "南沙", "zipcode": "819" }
                ]
            },
            {
                "city": "澎湖縣",
                "area": [
                    { "name": "馬公", "zipcode": "880" },
                    { "name": "西嶼", "zipcode": "881" },
                    { "name": "望安", "zipcode": "882" },
                    { "name": "七美", "zipcode": "883" },
                    { "name": "白沙", "zipcode": "884" },
                    { "name": "湖西", "zipcode": "885" }
                ]
            },
            {
                "city": "屏東縣",
                "area": [
                    { "name": "屏東", "zipcode": "900" },
                    { "name": "三地門", "zipcode": "901" },
                    { "name": "霧臺", "zipcode": "902" },
                    { "name": "瑪家", "zipcode": "903" },
                    { "name": "九如", "zipcode": "904" },
                    { "name": "里港", "zipcode": "905" },
                    { "name": "高樹", "zipcode": "906" },
                    { "name": "鹽埔", "zipcode": "907" },
                    { "name": "長治", "zipcode": "908" },
                    { "name": "麟洛", "zipcode": "909" },
                    { "name": "竹田", "zipcode": "911" },
                    { "name": "內埔", "zipcode": "912" },
                    { "name": "萬丹", "zipcode": "913" },
                    { "name": "潮州", "zipcode": "920" },
                    { "name": "泰武", "zipcode": "921" },
                    { "name": "來義", "zipcode": "922" },
                    { "name": "萬巒", "zipcode": "923" },
                    { "name": "崁頂", "zipcode": "924" },
                    { "name": "新埤", "zipcode": "925" },
                    { "name": "南州", "zipcode": "926" },
                    { "name": "林邊", "zipcode": "927" },
                    { "name": "東港", "zipcode": "928" },
                    { "name": "琉球", "zipcode": "929" },
                    { "name": "佳冬", "zipcode": "931" },
                    { "name": "新園", "zipcode": "932" },
                    { "name": "枋寮", "zipcode": "940" },
                    { "name": "枋山", "zipcode": "941" },
                    { "name": "春日", "zipcode": "942" },
                    { "name": "獅子", "zipcode": "943" },
                    { "name": "車城", "zipcode": "944" },
                    { "name": "牡丹", "zipcode": "945" },
                    { "name": "恆春", "zipcode": "946" },
                    { "name": "滿州", "zipcode": "947" }
                ]
            },
            {
                "city": "臺東縣",
                "area": [
                    { "name": "臺東", "zipcode": "950" },
                    { "name": "綠島", "zipcode": "951" },
                    { "name": "蘭嶼", "zipcode": "952" },
                    { "name": "延平", "zipcode": "953" },
                    { "name": "卑南", "zipcode": "954" },
                    { "name": "鹿野", "zipcode": "955" },
                    { "name": "關山", "zipcode": "956" },
                    { "name": "海端", "zipcode": "957" },
                    { "name": "池上", "zipcode": "958" },
                    { "name": "東河", "zipcode": "959" },
                    { "name": "成功", "zipcode": "961" },
                    { "name": "長濱", "zipcode": "962" },
                    { "name": "太麻里", "zipcode": "963" },
                    { "name": "金峰", "zipcode": "964" },
                    { "name": "大武", "zipcode": "965" },
                    { "name": "達仁", "zipcode": "966" }
                ]
            },
            {
                "city": "花蓮縣",
                "area": [
                    { "name": "花蓮", "zipcode": "970" },
                    { "name": "新城", "zipcode": "971" },
                    { "name": "秀林", "zipcode": "972" },
                    { "name": "吉安", "zipcode": "973" },
                    { "name": "壽豐", "zipcode": "974" },
                    { "name": "鳳林", "zipcode": "975" },
                    { "name": "光復", "zipcode": "976" },
                    { "name": "豐濱", "zipcode": "977" },
                    { "name": "瑞穗", "zipcode": "978" },
                    { "name": "萬榮", "zipcode": "979" },
                    { "name": "玉里", "zipcode": "981" },
                    { "name": "卓溪", "zipcode": "982" },
                    { "name": "富里", "zipcode": "983" }
                ]
            },
            {
                "city": "金門縣",
                "area": [
                    { "name": "金沙", "zipcode": "890" },
                    { "name": "金湖", "zipcode": "891" },
                    { "name": "金寧", "zipcode": "892" },
                    { "name": "金城", "zipcode": "893" },
                    { "name": "烈嶼", "zipcode": "894" },
                    { "name": "烏坵", "zipcode": "896" }
                ]
            },
            {
                "city": "連江縣",
                "area": [
                    { "name": "南竿", "zipcode": "209" },
                    { "name": "北竿", "zipcode": "210" },
                    { "name": "莒光", "zipcode": "211" },
                    { "name": "東引", "zipcode": "212" }
                ]
            }
        ];
        
        
        
        
        //  開啟燈箱
        viewNotice.addEventListener('click', function (e) {
            e.preventDefault();
            noticeModal.style.display = 'flex';
            noticeAgree.checked = agreeCheck.checked;
        });

        //  關閉燈箱
        exitNotice.addEventListener('click', function () {
            noticeModal.style.display = 'none';

            if (noticeAgree.checked) {
                agreeCheck.checked = true;
                agreedHiddenInput.value = 'true';
                sessionStorage.setItem("noticeAgreed", "true");
                if (errorMessage) errorMessage.classList.add("hidden");
            } else {
                agreeCheck.checked = false;
                agreedHiddenInput.value = 'false';
                sessionStorage.removeItem("noticeAgreed");
                if (errorMessage) errorMessage.classList.remove("hidden");
            }
        });

        //  同步狀態
        
        if (localStorage.getItem("agreedToTerms") === "true") {
            agreeCheck.checked = true;
            agreedHiddenInput.value = "true";
        } else {
            agreeCheck.checked = false;
            agreedHiddenInput.value = "false";
        }

        //  記錄變更
        agreeCheck.addEventListener("change", function () {
            localStorage.setItem("agreedToTerms", agreeCheck.checked);
            agreedHiddenInput.value = agreeCheck.checked ? "true" : "false";
        });

        noticeAgree.addEventListener('change', function () {
            if (!noticeAgree.checked) {
                agreeCheck.checked = false;
                agreedHiddenInput.value = 'false';
                sessionStorage.removeItem("noticeAgreed");
            } else if (errorMessage) {
                errorMessage.style.display = 'none';
            }
        });

        // 圖片預覽功能
        function previewImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            if (input && preview) {
                input.addEventListener('change', function () {
                    const file = input.files[0];
                    if (file && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            preview.innerHTML = `<img src="${e.target.result}" style="width:100%; height:100%; object-fit:cover;">`;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        preview.innerHTML = '';
                    }
                });
            }
        }

        previewImage('file_upload_cover', 'coverPhotoPreview');
        previewImage('file_upload_kitchen', 'kitchenPhotoPreview');
        previewImage('file_upload_store', 'storePhotoPreview');

        //  檔案名稱顯示
        function bindFileName(inputId, labelId) {
            const input = document.getElementById(inputId);
            const label = document.getElementById(labelId);
            input?.addEventListener('change', function () {
                label.textContent = input.files.length > 0 ? input.files[0].name : "尚未選擇檔案";
            });
        }

        bindFileName('file_upload_cover', 'coverFileName');
        bindFileName('file_upload_kitchen', 'kitchenFileName');
        bindFileName('file_upload_store', 'storeFileName');

        //  提示文字判斷
        function checkHintAndPreview(preview, hint) {
            if (!preview?.innerHTML.trim()) {
                hint && (hint.style.display = 'none');
            }
        }

        if (!hasSubmitted) {
            checkHintAndPreview(coverPreview, coverHint);
            checkHintAndPreview(kitchenPreview, kitchenHint);
            checkHintAndPreview(storePreview, storeHint);
        }
        
     // 自動隱藏錯誤提示=====
        document.querySelectorAll('.partner_input, .partner_select').forEach(function (field) {
            field.addEventListener('input', handleFieldChange);
            field.addEventListener('change', handleFieldChange);
        });

        function handleFieldChange(e) {
            // 找到下方最近的 .text-danger 顯示錯誤訊息的元素
            const parent = e.target.closest('.partner_form_controls');
            if (!parent) return;

            const errorDiv = parent.querySelector('.text-danger');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
        }
        
        
        document.querySelector("input[name='address']")?.addEventListener('input', function () {
            const error = this.nextElementSibling;
            if (error?.classList.contains('text-danger')) {
                error.style.display = 'none';
            }
        });

        // 針對縣市選擇時清除整合錯誤
        document.getElementById("citySelect")?.addEventListener('change', function () {
            const countyError = this.closest('.partner_form_controls')?.querySelector('.text-danger');
            if (countyError) {
                countyError.style.display = 'none';
            }
        });
        

        function clearPhotoErrorOnSelect(inputId) {
            const input = document.getElementById(inputId);
            const photoError = document.getElementById('photoError');
            if (input && photoError) {
                input.addEventListener('change', function () {
                    if (input.files.length > 0) {
                        photoError.style.display = 'none';
                        photoError.classList.add("hidden");
                    }
                });
            }
        }
        clearPhotoErrorOnSelect('file_upload_cover');
        clearPhotoErrorOnSelect('file_upload_kitchen');
        clearPhotoErrorOnSelect('file_upload_store');
        
   
 // ===== 還原 =====
//     function clearPhotoErrorOnSelect(inputId) {
//         const input = document.getElementById(inputId);
//         const photoError = document.getElementById('photoError');
//         if (input && photoError) {
//             input.addEventListener('change', function () {
//                 if (input.files.length > 0) {
//                     photoError.style.display = 'none';
//                     photoError.classList.add("hidden");
//                 }
//             });
//         }
//     }
//     clearPhotoErrorOnSelect('file_upload_cover');
//     clearPhotoErrorOnSelect('file_upload_kitchen');
//     clearPhotoErrorOnSelect('file_upload_store');
    
 



    exitNotice.addEventListener('click', function () {
        noticeModal.style.display = 'none';

        if (noticeAgree.checked) {
            agreeCheck.checked = true;
            agreedHiddenInput.value = 'true';
            localStorage.setItem("agreedToTerms", "true"); // ✅ 存入 localStorage
            sessionStorage.setItem("noticeAgreed", "true");
            if (errorMessage) errorMessage.classList.add("hidden");
        } else {
            agreeCheck.checked = false;
            agreedHiddenInput.value = 'false';
            localStorage.removeItem("agreedToTerms"); // ✅ 移除記憶
            sessionStorage.removeItem("noticeAgreed");
            if (errorMessage) errorMessage.classList.remove("hidden");
        }
        
        
        
        
        
        
        requestAnimationFrame(() => {
            const citySelect = document.getElementById('citySelect');
            const districtSelect = document.getElementById('districtSelect');
            const zipInput = document.getElementById('zipcodeInput');
console.log("🚀 citySelect =", citySelect);
console.log("🚀 districtSelect =", districtSelect);
console.log("🚀 zipInput =", zipInput);
console.log("📦 addrData =", addrData);
console.log("🏁 DOMContentLoaded triggered");
            const selectedCity = citySelect.value;
            const selectedDistrict = districtSelect.value;

            // 初始化縣市選單
            citySelect.innerHTML = '<option value="">請選擇縣市</option>';
            addrData.forEach(item => {
console.log("➡️ 加入城市:", item.city); // 👈 檢查是否有跑
              const option = document.createElement("option");
              option.value = item.city;
              option.textContent = item.city;
              if (item.city === selectedCity) option.selected = true;
              citySelect.appendChild(option);
            });

            // 如果已選擇縣市，初始化鄉鎮市區與郵遞區號
            if (selectedCity) {
              const cityObj = addrData.find(item => item.city === selectedCity);
              if (cityObj) {
                districtSelect.innerHTML = '<option value="">請選擇鄉鎮市區</option>';
                cityObj.area.forEach(area => {
                  const option = document.createElement("option");
                  option.value = area.name;
                  option.textContent = area.name;
                  if (area.name === selectedDistrict) option.selected = true;
                  districtSelect.appendChild(option);
                });

                const selectedZip = cityObj.area.find(area => area.name === selectedDistrict)?.zipcode;
                if (selectedZip) zipInput.value = selectedZip;
              }
            }

            // 當縣市改變時，重新載入鄉鎮與郵遞區號
            citySelect.addEventListener("change", function () {
              const selectedCity = this.value;
              const cityObj = addrData.find(item => item.city === selectedCity);
              districtSelect.innerHTML = '<option value="">請選擇鄉鎮市區</option>';
              zipInput.value = "";

              if (cityObj) {
                cityObj.area.forEach((area, index) => {
                  const option = document.createElement("option");
                  option.value = area.name;
                  option.textContent = area.name;
                  districtSelect.appendChild(option);
                  if (index === 0) zipInput.value = area.zipcode;
                });
              }
            });

            // 當鄉鎮市區改變時，更新郵遞區號
            districtSelect.addEventListener("change", function () {
              const selectedCity = citySelect.value;
              const selectedDistrict = this.value;
              const cityObj = addrData.find(item => item.city === selectedCity);
              if (cityObj) {
                const areaObj = cityObj.area.find(area => area.name === selectedDistrict);
                zipInput.value = areaObj ? areaObj.zipcode : "";
              }
            });
        });
        
        
        
        
    });
    });
//======dom結束=====




            </script>

</body>
</html>