<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>合作店家註冊 - 攏呷霸 ALLiEAT</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div class="partner_reg_wrapper">
    <div class="partner_reg_container">
        <h1 class="partner_reg_title">合作店家註冊</h1>
        <p class="partner_reg_subtitle">以下欄位皆為必填</p>

        <form id="storeRegisterForm" th:action="@{/store/register}" method="post" enctype="multipart/form-data" th:object="${store}">
            <!-- 店家名稱 -->
            <div class="partner_form_group">
                <label class="partner_form_label">店家名稱</label>
                <div class="partner_form_controls">
                    <input type="text" th:field="*{name}" class="partner_input">
                    <div class="partner_error_text" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                </div>
            </div>

            <!-- Email -->
            <div class="partner_form_group">
                <label class="partner_form_label">Email</label>
                <div class="partner_form_controls">
                    <input type="email" th:field="*{email}" class="partner_input">
                    <p class="partner_address_hint">請填寫有效的電子郵件信箱</p>
                    <div class="partner_error_text" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
                </div>
            </div>

            <!-- 密碼 -->
            <div class="partner_form_group">
                <label class="partner_form_label">密碼</label>
                <div class="partner_form_controls">
                    <input type="password" th:field="*{password}" class="partner_input">
                    <div class="partner_error_text" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
                </div>
            </div>

            <!-- 電話 -->
            <div class="partner_form_group">
                <label class="partner_form_label">行動電話</label>
                <div class="partner_form_controls">
                    <input type="tel" th:field="*{phoneNum}" class="partner_input">
                    <div class="partner_error_text" th:if="${#fields.hasErrors('phoneNum')}" th:errors="*{phoneNum}"></div>
                </div>
            </div>

            <!-- 統一編號 -->
            <div class="partner_form_group">
                <label class="partner_form_label">統一編號</label>
                <div class="partner_form_controls">
                    <input type="text" th:field="*{guiNum}" class="partner_input">
                    <div class="partner_error_text" th:if="${#fields.hasErrors('guiNum')}" th:errors="*{guiNum}"></div>
                </div>
            </div>

            <!-- 食品業者登錄字號 -->
            <div class="partner_form_group">
                <label class="partner_form_label">食品業者登錄字號</label>
                <div class="partner_form_controls">
                    <input type="text" th:field="*{businessRegNum}" class="partner_input">
                    <div class="partner_error_text" th:if="${#fields.hasErrors('businessRegNum')}" th:errors="*{businessRegNum}"></div>
                </div>
            </div>

            <!-- 地址區域 -->
            <div class="verification_form_group">
                <label class="verification_form_label">縣市</label>
                <div class="verification_form_controls">
                    <select class="verification_select" id="county" th:field="*{county}">
                        <option value="">請選擇縣市</option>
                        <option value="台北市">台北市</option>
                        <option value="新北市">新北市</option>
                        <option value="台中市">台中市</option>
                        <option value="台南市">台南市</option>
                        <option value="高雄市">高雄市</option>
                        <!-- 更多選項 -->
                    </select>
                </div>
            </div>

            <div class="verification_form_group">
                <label class="verification_form_label">鄉鎮市區</label>
                <div class="verification_form_controls">
                    <select class="verification_select" id="district" th:field="*{district}">
                        <option value="">請先選擇縣市</option>
                    </select>
                </div>
            </div>

            <!-- 多張照片上傳 -->
            <div class="verification_form_group">
                <label class="verification_form_label">上傳照片</label>
                <div class="verification_form_controls">
                    <input type="file" name="photos" accept="image/*" multiple class="verification_input">
                    <small class="text-muted">可上傳多張 .jpg/.png 照片，最多 5 張</small>
                </div>
            </div>


            <!-- 使用須知區塊 -->
            <div class="verification_form_group">
                <label class="verification_form_label">
                    <input type="checkbox" id="agreeCheck"> 我已閱讀並同意 <a href="#" id="viewNotice">使用須知</a>
                </label>
            </div>

            <input type="hidden" name="agreedToTerms" id="agreedToTerms" value="false">

            <div class="text-danger" th:if="${error != null and error.contains('須知') }" th:text="${error}"></div>

            <div class="verification_button_container">
                <a href="/" class="verification_back_btn">返回首頁</a>
                <button type="submit" class="verification_next_btn">下一步</button>
            </div>
        </form>
    </div>
</div>

<!-- ✅ 使用須知燈箱 Modal -->
<div id="noticeModal" class="modal" style="display:none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
    <div class="modal-content" style="background: white; padding: 20px; border-radius: 10px; width: 80%; max-height: 80%; overflow-y: auto;">
        <h3>使用須知</h3>
        <p style="white-space: pre-wrap; font-size: 14px; line-height: 1.8;">
            攏呷霸特指本平台內所稱愛心數，指由捐款人捐贈款項轉換成點數數據，由平台寄送或核發至受助者會員帳號中，用以兌換與平台合作之店家所提供之待用餐點。
        </p>
        <label><input type="checkbox" id="noticeAgree"> 已閱讀且同意上述須知內容</label>
        <div style="margin-top: 20px; display: flex; justify-content: space-between;">
            <button id="closeNotice" style="padding: 6px 12px;">回首頁</button>
            <button id="agreeNotice" style="padding: 6px 12px;">下一步</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const agreeCheck = document.getElementById('agreeCheck');
    const viewNotice = document.getElementById('viewNotice');
    const noticeModal = document.getElementById('noticeModal');
    const noticeAgree = document.getElementById('noticeAgree');
    const agreeNotice = document.getElementById('agreeNotice');
    const closeNotice = document.getElementById('closeNotice');
    const agreedToTerms = document.getElementById('agreedToTerms');

    if (viewNotice) {
        viewNotice.addEventListener('click', function (e) {
            e.preventDefault();
            noticeAgree.checked = false;
            noticeModal.style.display = 'flex';
        });
    }

    if (agreeNotice) {
        agreeNotice.addEventListener('click', function () {
            if (noticeAgree.checked) {
                agreeCheck.checked = true;
                agreedToTerms.value = 'true';
                noticeModal.style.display = 'none';
            } else {
                alert('請勾選同意使用須知');
            }
        });
    }

    if (closeNotice) {
        closeNotice.addEventListener('click', function () {
            noticeModal.style.display = 'none';
            noticeAgree.checked = false;
        });
    }

    // ✅ 地區下拉選單動態切換
    const countySelect = document.getElementById("county");
    const districtSelect = document.getElementById("district");

    const taiwanDistricts = {
        "台北市": ["中正區", "大同區", "中山區"],
        "新北市": ["板橋區", "新店區", "中和區"],
        "台中市": ["西屯區", "北區", "南屯區"],
        // 可依需求補齊
    };

    countySelect.addEventListener("change", function () {
        const selectedCounty = this.value;
        const districts = taiwanDistricts[selectedCounty] || [];

        districtSelect.innerHTML = '<option value="">請選擇鄉鎮市區</option>';

        districts.forEach(d => {
            const opt = document.createElement("option");
            opt.value = d;
            opt.text = d;
            districtSelect.appendChild(opt);
        });
    });
});
</script>
</body>
</html>
