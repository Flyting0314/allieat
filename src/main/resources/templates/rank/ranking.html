<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">
<head >
<th:block th:replace="fragments/header :: header"></th:block>
<link th:href="@{/css/indexRank.css}" rel="stylesheet">

</head>

<body>
   <th:block th:replace="fragments/bodySection :: bodySection"></th:block>

<div class="ranking-and-total-wrapper">

    <!-- ğŸ…° å·¦å´ Aå€ï¼š4 å€‹æ’è¡Œæ¦œ -->
    <div class="ranking-left-column">
        <div class="tabs">
            <div class="tab active" onclick="switchAreaTab('a', 'personal-total', this)">å€‹äººç¸½ææ¬¾</div>
            <div class="tab" onclick="switchAreaTab('a', 'company-total', this)">ä¼æ¥­ç¸½ææ¬¾</div>
            <div class="tab" onclick="switchAreaTab('a', 'personal-monthly', this)">æœ¬æœˆå€‹äºº</div>
            <div class="tab" onclick="switchAreaTab('a', 'company-monthly', this)">æœ¬æœˆä¼æ¥­</div>
        </div>


        <div id="personal-total" class="ranking-container active area-a">
        <h2>å€‹äººææ¬¾æ’è¡Œæ¦œï¼ˆTop 20ï¼‰</h2>
    <table>
        <thead><tr><th>#</th><th>å§“å</th><th>é‡‘é¡</th></tr></thead>
        <tbody>
            <tr th:each="r, stat : ${personalTopList}">
                <td th:text="${stat.count}"></td>
                <td th:text="${r.identityData}"></td>
                <td th:text="${r.totalDonation}"></td>
            </tr>
        </tbody>
    </table>
    </div>
    
    
        <div id="company-total" class="ranking-container area-a">
        <h2>ä¼æ¥­ææ¬¾æ’è¡Œæ¦œï¼ˆTop 20ï¼‰</h2>
    <table>
        <thead><tr><th>#</th><th>ä¼æ¥­åç¨±</th><th>é‡‘é¡</th></tr></thead>
        <tbody>
            <tr th:each="r, stat : ${companyTopList}">
                <td th:text="${stat.count}"></td>
                <td th:text="${r.identityData}"></td>
                <td th:text="${r.totalDonation}"></td>
            </tr>
        </tbody>
    </table>
    </div>
    
    
        <div id="personal-monthly" class="ranking-container area-a">
        <h2>æœ¬æœˆå€‹äººææ¬¾æ’è¡Œæ¦œ</h2>
    <table>
        <tbody>
            <tr th:each="r, stat : ${monthlyPersonalTopList}">
                <td th:text="${stat.count}"></td>
                <td th:text="${r.identityData}"></td>
                <td th:text="${r.totalDonation}"></td>
            </tr>
        </tbody>
    </table>
    </div>
    
    
        <div id="company-monthly" class="ranking-container area-a">
        <h2> æœ¬æœˆä¼æ¥­ææ¬¾æ’è¡Œæ¦œ</h2>
    <table>
        <tbody>
            <tr th:each="r, stat : ${monthlyCompanyTopList}">
                <td th:text="${stat.count}"></td>
                <td th:text="${r.identityData}"></td>
                <td th:text="${r.totalDonation}"></td>
            </tr>
        </tbody>
    </table>
    </div>
    </div>


    <div class="ranking-right-column">
        <!-- ç´¯è¨ˆææ¬¾é‡‘é¡ -->
        <div class="donation-total-supercard">
            <h2> ç´¯è¨ˆææ¬¾é‡‘é¡ </h2>
            <div id="donationAmount" class="donation-amount-glow">NT$ 0</div>
            <p class="donation-caption">æ„Ÿè¬æ¯ä½å¤©ä½¿çš„æº«æš– â¤ï¸</p>
        </div>

        <!-- Tab åˆ‡æ› -->
        <div class="tabs">
            <div class="tab active" onclick="switchAreaTab('b', 'new-donors', this)">æ–°æ˜Ÿæ¦œ</div>
            <div class="tab" onclick="switchAreaTab('b', 'latest-donations', this)">æœ€æ–°ææ¬¾</div>
        </div>

        <div id="new-donors" class="ranking-container active area-b">
        <h2> æ–°æ˜Ÿæ¦œï¼ˆé¦–æ¬¡ææ¬¾ï¼‰</h2>
    <table>
        <thead><tr><th>#</th><th>å§“å</th><th>é‡‘é¡</th></tr></thead>
        <tbody>
            <tr th:each="d, stat : ${newDonorList}">
                <td th:text="${stat.count}"></td>
                <td th:text="${d.identityData}"></td>
                <td th:text="${d.donationIncome}"></td>
            </tr>
        </tbody>
    </table>
    </div>
        <div id="latest-donations" class="ranking-container area-b">
        <h2>æœ€æ–°ææ¬¾</h2>
    <table>
        <thead><tr><th>#</th><th>å§“å/ä¼æ¥­</th><th>é‡‘é¡</th><th>æ™‚é–“</th></tr></thead>
        <tbody>
            <tr th:each="d, stat : ${latestDonationList}">
                <td th:text="${stat.count}"></td>
                <td th:text="${d.identityData}"></td>
                <td th:text="${d.donationIncome}"></td>
                <td th:text="${d.createdTime}"></td>
            </tr>
        </tbody>
    </table>
    </div>
    </div>

</div>







<!-- Footer Start -->
<th:block th:replace="fragments/footer :: footer"></th:block>

 <!-- Footer End -->

<!-- Back to Top -->
<a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="fa fa-angle-double-up"></i></a>

<!-- JavaScript Libraries -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
<script src="lib/easing/easing.min.js"></script>
<script src="lib/waypoints/waypoints.min.js"></script>
<script src="lib/owlcarousel/owl.carousel.min.js"></script>
<script src="lib/tempusdominus/js/moment.min.js"></script>
<script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
<script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

<!-- Contact Javascript File -->
<script src="mail/jqBootstrapValidation.min.js"></script>
<script src="mail/contact.js"></script>

<!-- Template Javascript -->
<script src="js/main.js"></script>

<!-- Login JavaScript -->
<!-- ç”¨æˆ¶é¡å‹åˆ‡æ› -->
<script src="/js/jquery-3.2.1.min.js"></script>
<!-- <script src="js/indexRank.js"></script> -->
<script>
function switchAreaTab(area, rankId, tabElement) {
    
    const allTabs = document.querySelectorAll(`.tabs`);
    const allRankingContainers = document.querySelectorAll(`.ranking-container`);

    
    allTabs.forEach(tabGroup => {
        tabGroup.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    });
    tabElement.classList.add('active');

   
    allRankingContainers.forEach(div => {
        if (div.classList.contains(`area-${area}`)) {
            div.classList.remove('active');
        }
    });
    document.getElementById(rankId).classList.add('active');
}
    
    
    //intime

    let currentAmount = 0;

    function animateDonationAmount(target) {
        const element = document.getElementById('donationAmount');
        const duration = 1000; // ç¸½å‹•ç•«æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
        const frameRate = 60;
        const totalFrames = Math.round(duration / (1000 / frameRate));
        const increment = (target - currentAmount) / totalFrames;
        let frame = 0;

        function updateNumber() {
            frame++;
            currentAmount += increment;

            // åŠ ä¸Š scale å‹•ç•«é¡
            element.classList.add('animate');
            element.textContent = 'NT$ ' + Math.floor(currentAmount).toLocaleString();

            if (frame < totalFrames) {
                requestAnimationFrame(updateNumber);
            } else {
                currentAmount = target;
                element.textContent = 'NT$ ' + target.toLocaleString();
                element.classList.remove('animate');
            }
        }

        requestAnimationFrame(updateNumber);
    }

    function fetchDonationTotal() {
        fetch('/api/donation/total-amount')
            .then(response => response.json())
            .then(data => {
                const target = data.totalAmount || 0;
                if (target > currentAmount) {
                    animateDonationAmount(target);
                }
            })
            .catch(error => {
                console.error('å–å¾—ææ¬¾é‡‘é¡å¤±æ•—:', error);
            });
    }

    // é é¢è¼‰å…¥èˆ‡å®šæ™‚æ›´æ–°
    document.addEventListener('DOMContentLoaded', () => {
        fetchDonationTotal(); // åˆå§‹åŠ è¼‰
        setInterval(fetchDonationTotal, 60000); // æ¯åˆ†é˜æ›´æ–°ä¸€æ¬¡
    });
    

</script>

</body>
</html>

