<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å–é¤åœ°é» - æ”å‘·éœ¸ ALLiEAT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
    }

    .navbar {
      background-color: white;
      padding: 15px 30px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .navbar .logo {
      display: flex;
      align-items: center;
    }

    .navbar .logo img {
      height: 60px;
      margin-right: 15px;
    }

    .navbar h1 {
      font-size: 28px;
      color: #003366;
      font-weight: bold;
    }

    .container {
      display: flex;
      padding: 30px;
    }

    .store-info {
      width: 25%;
      padding: 20px;
      border: 2px dashed #aaaaff;
      border-radius: 10px;
      background-color: #ffffff;
      margin-right: 30px;
    }

    .store-info h2 {
      margin: 0;
      font-size: 20px;
      color: #333;
    }

    .store-info p {
      margin-top: 8px;
      font-size: 16px;
      color: #555;
    }

    #map {
      width: 75%;
      height: 500px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <div class="logo">
      <img src="/img/logo3.png" alt="logo" />
      <h1>æ”å‘·éœ¸</h1>
    </div>
    <div>
      <a href="/index.html">é¦–é </a> | <a href="/logout">ç™»å‡º</a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container">
    <div class="store-info">
      <h2 id="storeName">åº—å®¶åç¨±</h2>
      <p id="storeAddress">åº—å®¶åœ°å€</p>
    </div>
    <div id="map"></div>
  </div>

  <!-- Google Maps + å–é¤è³‡è¨Š -->
  <script>
    const orderData = JSON.parse(sessionStorage.getItem("orderSuccess"));
    console.log("ğŸ§ª orderData from sessionStorage:", orderData);
    console.log("ğŸ“Œ storeLat:", orderData.storeLat, "storeLng:", orderData.storeLng);
    
    console.log("ğŸ§ª orderData from sessionStorage:", orderData); // â† âœ… æ”¾é€™è£¡ï¼

    function initMap() {
    	  const defaultLocation = { lat: 25.0330, lng: 121.5654 }; // fallback å°åŒ—

    	  console.log("ğŸ§ª orderData from sessionStorage:", orderData);

    	  const storeLat = parseFloat(orderData?.storeLat);
    	  const storeLng = parseFloat(orderData?.storeLng);
    	  console.log("ğŸ§­ storeLat:", storeLat, "storeLng:", storeLng);

    	  const storeLocation = (!isNaN(storeLat) && !isNaN(storeLng))
    	    ? { lat: storeLat, lng: storeLng }
    	    : defaultLocation;

    	  const map = new google.maps.Map(document.getElementById("map"), {
    	    zoom: 16,
    	    center: storeLocation,
    	  });

    	  const marker = new google.maps.Marker({
    	    position: storeLocation,
    	    map: map,
    	  });

    	  const infoWindow = new google.maps.InfoWindow({
    	    content: `
    	      <div>
    	        <strong>${orderData?.storeName || 'åº—å®¶åç¨±'}</strong><br/>
    	        å–é¤è™Ÿç¢¼ï¼š${orderData?.pickupCode || '------'}<br/>
    	        å–é¤æ™‚é–“ï¼šåº—å®¶æ¥å–®å¾Œæœƒé€šçŸ¥æ‚¨
    	      </div>
    	    `
    	  });

    	  marker.addListener("click", () => {
    	    infoWindow.open(map, marker);
    	  });

    	  infoWindow.open(map, marker);
    	}


    document.addEventListener("DOMContentLoaded", () => {
      if (!orderData) {
        alert("âš ï¸ ç„¡æ³•å–å¾—è¨‚å–®è³‡è¨Šï¼Œå°‡è·³å›é¦–é ï¼");
        location.href = "/index.html";
        return;
      }

      document.getElementById("storeName").textContent = orderData.storeName || 'æœªçŸ¥åº—å®¶';
      document.getElementById("storeAddress").textContent = orderData.address || 'æœªæä¾›åœ°å€';
    });
  </script>

  <!-- Google Maps API (æ›¿æ›æˆä½ è‡ªå·±çš„ key) -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCwk4bH6RdOWmqwmrpdYu7-NKZin0St0vQ&callback=initMap"
    async defer>
  </script>
</body>
</html>
