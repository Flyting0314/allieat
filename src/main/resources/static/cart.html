<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è³¼ç‰©è»Š - ALLiEAT</title>
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.0/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css2?family=Satisfy&display=swap">
<!-- Customized Bootstrap Stylesheet -->
<link rel="stylesheet" th:href="@{/css/style.css}" />
<style>
:root {
    --primary: #da9f5b;
    --primary-dark: #c88c4a;
    --secondary: #6c757d;
    --light: #f8f9fa;
    --dark: #343a40;
    --success: #28a745;
    --border: #dee2e6;
    --shadow: 0 .5rem 1rem rgba(0, 0, 0, .15);
}

body {
    font-family: 'Noto Sans TC', Arial, sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 0;
    color: var(--dark);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

/* Main Content Styles */
main {
    flex: 1;
    padding: 30px 0;
}

.cart-container {
    max-width: 800px;
    margin: 0 auto 50px;
    background-color: white;
    border-radius: 10px;
    box-shadow: var(--shadow);
    padding: 25px;
}

.cart-container h2 {
    color: var(--primary);
    text-align: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--primary);
    font-weight: 600;
}

.cart-header {
    display: grid;
    grid-template-columns: 3fr 3fr 2fr 2fr 2fr;
    font-weight: bold;
    background-color: var(--light);
    padding: 12px 10px;
    border-radius: 5px;
    margin-bottom: 15px;
    text-align: center;
}

.cart-item {
    display: grid;
    grid-template-columns: 3fr 3fr 2fr 2fr 2fr;
    align-items: center;
    padding: 15px;
    margin-bottom: 10px;
    border: 1px solid var(--border);
    border-radius: 5px;
    transition: all 0.2s ease;
}

.cart-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.cart-item > div {
    padding: 0 10px;
    text-align: center;
}

.cart-total {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    font-weight: bold;
    font-size: 18px;
    margin-top: 20px;
    padding: 15px;
    background-color: var(--light);
    border-radius: 5px;
}

.cart-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
}

.cart-actions button {
    padding: 12px 20px;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 15px;
}

.cart-container .btn-primary {
    background-color: var(--primary);
    color: white;
}

.cart-container .btn-primary:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
}

.cart-container .btn-secondary {
    background-color: var(--secondary);
    color: white;
}

.cart-container .btn-secondary:hover {
    background-color: #5a6268;
    transform: translateY(-2px);
}

.cart-container .btn-success {
    background-color: var(--success);
    color: white;
}

.cart-container .btn-success:hover {
    background-color: #218838;
    transform: translateY(-2px);
}

.btn-sm.btn-outline-primary {
    color: var(--primary);
    border-color: var(--primary);
}

.btn-sm.btn-outline-primary:hover {
    background-color: var(--primary);
    color: white;
}

/* Responsive Styles */
@media (max-width: 768px) {
    .cart-header {
        display: none;
    }
    
    .cart-item {
        display: flex;
        flex-direction: column;
        text-align: left;
        gap: 10px;
    }
    
    .cart-item > div {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        text-align: right;
        border-bottom: 1px solid #eee;
        padding: 8px 5px;
    }
    
    .cart-item > div:last-child {
        border-bottom: none;
    }
    
    .cart-item > div:nth-child(1)::before {
        content: "ä¸»é¤";
        font-weight: bold;
    }
    
    .cart-item > div:nth-child(2)::before {
        content: "é™„é¤";
        font-weight: bold;
    }
    
    .cart-item > div:nth-child(3)::before {
        content: "æ•¸é‡";
        font-weight: bold;
    }
    
    .cart-item > div:nth-child(4)::before {
        content: "å–®åƒ¹";
        font-weight: bold;
    }
    
    .cart-item > div:nth-child(5)::before {
        content: "å°è¨ˆ";
        font-weight: bold;
    }
    
    .cart-total {
        font-size: 16px;
    }
    
    .cart-actions {
        flex-direction: column;
        gap: 15px;
    }
    
    .cart-actions button {
        width: 100%;
        justify-content: center;
    }
}
</style>
</head>
<body>
	<!-- Navbar Start -->
<div class="container-fluid p-0 nav-bar">
    <nav class="navbar navbar-expand-lg bg-none navbar-dark py-3">
        <a href="/index.html" class="navbar-brand px-lg-4 m-0">
            <h1 class="m-0 display-4 text-uppercase text-white">
                <img src="/img/logo3.png" width="80px" height="80px" alt="ALLiEAT Logo"
                     style="vertical-align: middle; border-radius: 50%; object-fit: cover;">
                <span style="font-family: 'Satisfy', cursive;">ALLiEAT</span>
            </h1>
        </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
            <div class="navbar-nav ml-auto p-4">
                <a href="/index" class="nav-item nav-link active">é—œæ–¼æˆ‘å€‘</a>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">ææ¬¾å°ˆå€</a>
                    <div class="dropdown-menu text-capitalize">
                        <a href="/dona/donaAddA" class="dropdown-item">æˆ‘è¦ææ¬¾</a>
                        <a href="dona/donaAddD" class="dropdown-item">ææ¬¾æŸ¥è©¢</a>
                    </div>
                </div>
                <a href="/map2" class="nav-item nav-link">æˆ‘è¦å–é¤ / é»é¤</a>

                <!-- ç™»å…¥ / ç™»å‡ºé¸é …ï¼Œéœæ…‹é é¢ç„¡æ³•å‹•æ…‹åˆ‡æ› -->
                <a href="/registerAndLogin" class="nav-item nav-link">è¨»å†Š/ç™»å…¥</a>
                <!-- å¯é¸ï¼šç¡¬å¯«ä¸€å€‹ç™»å‡º/æœƒå“¡å°ˆå€æŒ‰éˆ•ï¼Œä¾å¯¦éš›éœ€æ±‚é¡¯ç¤º -->
                <a href="/registerAndLogin/logout" class="nav-item nav-link">ç™»å‡º</a>
                <a href="/member" id="memberAreaBtn" class="nav-item nav-link">æœƒå“¡å°ˆå€</a>
            </div>
        </div>
    </nav>
</div>
</header>

<!-- Hero Section Start -->
<section id="hero">
    <div class="container-fluid p-0 mb-5">
        <div id="hero-carousel" class="carousel slide overlay-bottom" data-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active" style="
                    background-image: url(/img/åœ–ç‰‡3.png);
                    background-size: 110% auto;
                    background-position: center 50px;
                    height: 300px;
                    filter: brightness(225%);">
                    <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
                        <h2 class="text-primary font-weight-medium m-0"></h2>
                        <h1 class="display-1 text-white m-0"></h1>
                        <h2 class="text-white m-0"></h2>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Hero Section End -->

	<!-- Main Content -->
	<main>
		<div class="cart-container">
			<h2>æ‚¨çš„è³¼ç‰©è»Š</h2>

			<div class="cart-header">
				<div>ä¸»é¤</div>
				<div>é™„é¤</div>
				<div>æ•¸é‡</div>
				<div>å–®åƒ¹</div>
				<div>å°è¨ˆ</div>
			</div>

			<div id="cartItems"></div>

			<div class="cart-total" id="cartTotal">ç¸½è¨ˆï¼š0 é»</div>

			<div class="cart-actions">
				<div>
					<button class="btn-primary" onclick="goBackToOrder()">
						<i class="fas fa-arrow-left"></i> ç¹¼çºŒé»é¤
					</button>
				</div>
				<div>
					<button class="btn-secondary" onclick="clearCart()">
						<i class="fas fa-trash"></i> æ¸…ç©ºè³¼ç‰©è»Š
					</button>
				</div>
				<div>
					<button class="btn-success" onclick="confirmOrder()">
						<i class="fas fa-check"></i> ç¢ºèªè¨‚å–®
					</button>
				</div>
			</div>
		</div>
	</main>
	<!-- Main Content End -->

	<!-- Footer Start -->
	<div
		class="container-fluid footer text-white pt-5 px-0 position-relative overlay-top">
		<div class="row mx-0 pt-5 px-sm-3 px-lg-5 mt-4">
			<div class="col-lg-3 col-md-6 mb-5">
				<h4 class="text-white text-uppercase mb-4"
					style="letter-spacing: 3px;">è¯çµ¡æˆ‘å€‘</h4>
				<p>
					<i class="fa fa-map-marker-alt mr-2"></i>å°åŒ—å¸‚æ„›ä½ å€æ„›ä½ ä¸€è·¯5255è™Ÿ
				</p>
				<p>
					<i class="fa fa-phone-alt mr-2"></i>02-2222-5252
				</p>
				<p class="m-0">
					<i class="fa fa-envelope mr-2"></i>allieat105@gmail.com
				</p>
			</div>
			<div class="col-lg-3 col-md-6 mb-5">
				<h4 class="text-white text-uppercase mb-4"
					style="letter-spacing: 3px;">é—œæ³¨æˆ‘å€‘</h4>
				<p>åœ¨é€™å€‹ä¸–ç•Œä¸Šï¼Œæœ‰äº›äººæ¯å¤©ç‚ºäº†æº«é£½è€ŒåŠªåŠ›ï¼Œè€Œä½ çš„ä¸€ä»½æ„›å¿ƒï¼Œå¯ä»¥æˆç‚ºä»–å€‘çš„ä¸€çµ²å¸Œæœ›ã€‚æ„›å¿ƒä»£ç”¨é¤æ˜¯ä¸€å€‹ç°¡å–®å»å……æ»¿æº«åº¦çš„å…¬ç›Šè¡Œå‹•ï¼Œè®“éœ€è¦å¹«åŠ©çš„äººèƒ½å¤ ç²å¾—ä¸€ä»½ç†±é¨°é¨°çš„é¤é»ï¼Œæ„Ÿå—ç¤¾æœƒçš„é—œæ‡·èˆ‡æ”¯æŒã€‚</p>
				<div class="d-flex justify-content-start">
					<a class="btn btn-lg btn-outline-light btn-lg-square mr-2" href="#"><i
						class="fab fa-twitter"></i></a> <a
						class="btn btn-lg btn-outline-light btn-lg-square mr-2" href="#"><i
						class="fab fa-facebook-f"></i></a> <a
						class="btn btn-lg btn-outline-light btn-lg-square mr-2" href="#"><i
						class="fab fa-linkedin-in"></i></a> <a
						class="btn btn-lg btn-outline-light btn-lg-square" href="#"><i
						class="fab fa-instagram"></i></a>
				</div>
			</div>
			<div class="col-lg-3 col-md-6 mb-5">
				<h4 class="text-white text-uppercase mb-4"
					style="letter-spacing: 3px;">å®¢æœæ™‚é–“</h4>
				<div>
					<h6 class="text-white text-uppercase">å‘¨ä¸€ - é€±äº”</h6>
					<p>æ—©ä¸Š10:00 - æ™šä¸Š21:00</p>
					<h6 class="text-white text-uppercase">é€±å…­ - é€±æ—¥</h6>
					<p>æ—©ä¸Š11:00 - æ™šä¸Š19:00</p>
				</div>
			</div>
			<div class="col-lg-3 col-md-6 mb-5">
				<h4 class="text-white text-uppercase mb-4"
					style="letter-spacing: 3px;">è¨‚é–±é›»å­å ±</h4>
				<p>è¨‚é–±æ„›å¿ƒä»£ç”¨é¤é›»å­å ±ï¼Œç²å–æœ€æ–°æ„›å¿ƒè¨ˆç•«ã€æ–°å¢åˆä½œåº—å®¶èˆ‡å…¬ç›Šæ´»å‹•è³‡è¨Šï¼Œè®“æº«æš–æŒçºŒå‚³éï¼</p>
				<div class="w-100">
					<div class="input-group">
						<input type="text" class="form-control border-light"
							style="padding: 25px;" placeholder="è¼¸å…¥æ‚¨çš„ä¿¡ç®±">
						<div class="input-group-append">
							<button class="btn btn-primary font-weight-bold px-3">ç«‹å³è¨‚é–±</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div
			class="container-fluid text-center text-white border-top mt-4 py-4 px-sm-3 px-md-5"
			style="border-color: rgba(256, 256, 256, .1) !important;">
			<p class="mb-2 text-white">
				ç‰ˆæ¬Šæ‰€æœ‰ &copy; <a class="font-weight-bold" href="#">æ”å‘·éœ¸è‚¡ä»½æœ‰é™å…¬å¸</a>.
				ä¿ç•™æ‰€æœ‰æ¬Šåˆ©
			</p>
			<p class="m-0 text-white">
				ç¶²ç«™è¨­è¨ˆç”± <a class="font-weight-bold" href="#">æ”å‘·éœ¸è‚¡ä»½æœ‰é™å…¬å¸ è¨­è¨ˆéƒ¨ è¨­è¨ˆ</a>
			</p>
		</div>
	</div>
	<!-- Footer End -->

	<!-- JavaScript Libraries -->
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.0/js/bootstrap.bundle.min.js"></script>

	<script>
    let cartData = [];

    function loadCart() {
        fetch('/api/cart')
            .then(response => response.json())
            .then(cart => {
                if (!cart || cart.length === 0) {
                    document.getElementById('cartItems').innerHTML = '<div class="text-center text-muted mt-4">è³¼ç‰©è»Šæ˜¯ç©ºçš„ã€‚</div>';
                    document.getElementById('cartTotal').textContent = 'ç¸½è¨ˆï¼š0 é»';
                    return;
                }

                fetch('/meal/cart/details', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cart)
                })
                .then(res => res.json())
                .then(details => {
                    console.log("API å›å‚³ cart detailsï¼š", details);

                    cartData = details;

                    // å„²å­˜ storeId / storeName ä¾›è¿”å›ä½¿ç”¨
                    if (details.length > 0) {
                        localStorage.setItem('selectedFood', JSON.stringify({
                            storeId: details[0].storeId,
                            storeName: details[0].storeName
                        }));
                    }

                    renderCart();
                })
                .catch(err => {
                    console.error('ç²å–è³¼ç‰©è»Šè©³æƒ…å¤±æ•—ï¼š', err);
                    document.getElementById('cartItems').innerHTML = '<div class="text-center text-danger">è¼‰å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</div>';
                });
            })
            .catch(err => {
                console.error('ç²å–è³¼ç‰©è»Šå¤±æ•—ï¼š', err);
                document.getElementById('cartItems').innerHTML = '<div class="text-center text-danger">è¼‰å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</div>';
            });
    }

    function renderCart() {
        const cartItems = document.getElementById('cartItems');
        let total = 0;
        cartItems.innerHTML = '';

        cartData.forEach((item, index) => {
            const itemTotal = item.cost * item.quantity;
            total += itemTotal;

            const itemDiv = document.createElement('div');
            itemDiv.className = 'cart-item d-grid mb-3';
            itemDiv.style.gridTemplateColumns = '3fr 3fr 2fr 2fr 2fr';
            itemDiv.style.alignItems = 'center';
            itemDiv.innerHTML = `
                <div>${item.foodName}</div>
                <div>${item.attachedName}</div>
                <div>
                    <div class="d-flex justify-content-center align-items-center">
                        <button class="btn btn-sm btn-outline-primary" onclick="updateQuantity(${index}, -1)">-</button>
                        <span class="mx-2">${item.quantity}</span>
                        <button class="btn btn-sm btn-outline-primary" onclick="updateQuantity(${index}, 1)">+</button>
                    </div>
                </div>
                <div>${item.cost} é»</div>
                <div>${itemTotal} é»</div>
            `;
            cartItems.appendChild(itemDiv);
        });

        document.getElementById('cartTotal').textContent = `ç¸½è¨ˆï¼š${total} é»`;
    }

    function updateQuantity(index, change) {
        if (cartData[index].quantity + change < 1) return;

        cartData[index].quantity += change;
        renderCart();

        const item = cartData[index];

        console.log("ğŸ”„ æ›´æ–°æ•¸é‡", {
            foodId: item.foodId,
            attachedId: item.attachedId,
            quantity: item.quantity
        });

        fetch('/api/cart/update', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                foodId: item.foodId,
                attachedId: item.attachedId,
                quantity: item.quantity
            })
        })
        .then(res => {
            if (!res.ok) {
                return res.text().then(msg => {
                    alert('âŒ æ›´æ–°å¤±æ•—ï¼š' + msg);
                    loadCart();
                });
            }
        })
        .catch(err => {
            console.error('âŒ æ›´æ–°æ•¸é‡æ™‚ç™¼ç”ŸéŒ¯èª¤:', err);
            loadCart();
        });
    }

    function clearCart() {
        if (confirm('ç¢ºå®šè¦æ¸…ç©ºè³¼ç‰©è»Šå—ï¼Ÿ')) {
            fetch('/api/cart/clear', { method: 'POST' })
                .then(() => {
                    cartData = [];
                    document.getElementById('cartItems').innerHTML = '<div class="text-center text-muted mt-4">è³¼ç‰©è»Šæ˜¯ç©ºçš„ã€‚</div>';
                    document.getElementById('cartTotal').textContent = 'ç¸½è¨ˆï¼š0 é»';
                });
        }
    }

    function goBackToOrder() {
        const selectedFood = JSON.parse(localStorage.getItem('selectedFood'));
        if (selectedFood && selectedFood.storeId && selectedFood.storeName) {
            const storeId = selectedFood.storeId;
            const storeName = encodeURIComponent(selectedFood.storeName);
            window.location.href = `/orderfood.html?id=${storeId}&name=${storeName}`;
        } else {
            alert('æœªèƒ½æ‰¾åˆ°æœ‰æ•ˆçš„é¤å»³è³‡æ–™ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
        }
    }

    function confirmOrder() {
        if (cartData.length === 0) {
            alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œè«‹å…ˆæ·»åŠ å•†å“');
            return;
        }
        window.location.href = '/checkout.html';
    }

    window.onload = loadCart;
</script>

</body>
</html>
</body>
</html>