<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Firebase æ¨æ’­æ¸¬è©¦é </title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
	<h1>ğŸ”” Firebase æ¨æ’­æ¸¬è©¦</h1>
	<p>é€™æ˜¯ç”¨ä¾†æ¸¬è©¦ FCM æ¨æ’­æ˜¯å¦æ­£å¸¸çš„é é¢ã€‚</p>
	<p id="token" style="word-break: break-all; color: green;"></p>

	<!-- Firebase SDK -->
	<script
		src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
	<script
		src="https://www.gstatic.com/firebasejs/10.8.0/firebase-messaging-compat.js"></script>

	<script>
    // âœ… æ›¿æ›æˆä½ çš„å°ˆæ¡ˆè¨­å®š
    firebase.initializeApp({
      apiKey: "AIzaSyA68z34B-2gMTza5XihaqtGUeNlKi3-pVU",
      authDomain: "allieat-notification.firebaseapp.com",
      projectId: "allieat-notification",
      messagingSenderId: "613984391786",
      appId: "1:613984391786:web:f5fc9510d0ef5f972d3013"
    });

    const messaging = firebase.messaging();

    navigator.serviceWorker.register('/firebase-messaging-sw.js')
      .then(reg => {
    		return messaging.getToken({
      			vapidKey: "BMhduGYc_FYGv9W9jCouQGGJlIkDi71agZasPO1ufaui5qXbVIY35W4_MVmw1P3GlcV026ifk5sS1bOLQNDidUY",
      			serviceWorkerRegistration: reg // âœ… ä¿®æ­£è®Šæ•¸å + åˆä½µå‘¼å«
    		});
  	  })
      .then(token => {
        console.log("âœ… Token:", token);
        document.getElementById("token").textContent = `ä½ çš„ FCM tokenï¼š${token}`;
        // ğŸ” å¯ç”¨ fetch å‚³å›å¾Œç«¯èˆ‡è¨‚å–®ç¶å®š
      })
      .catch(err => {
        console.error("âŒ ç„¡æ³•å–å¾— token", err);
        document.getElementById("token").textContent = "âš ï¸ ç„¡æ³•å–å¾— tokenï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨æ¬Šé™æˆ– Firebase è¨­å®š";
      });

    messaging.onMessage(payload => {
      console.log("ğŸ“¨ å‰æ™¯æ¨æ’­è¨Šæ¯ï¼š", payload);
      alert(`${payload.notification.title}\n${payload.notification.body}`);
    });
  </script>
</body>
</html>
